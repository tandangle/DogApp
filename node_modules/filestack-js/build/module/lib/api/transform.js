/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Filelink } from './../filelink';
/**
 * @private
 */
var toSnakeCase = function (original) {
    var snakeCased = {};
    var keys = Object.keys(original);
    for (var i = 0; i < keys.length; i++) {
        var newKey = keys[i].split(/(?=[A-Z])/).join('_').toLowerCase();
        if (typeof original[keys[i]] === 'object' && !Array.isArray(original[keys[i]])) {
            snakeCased[newKey] = toSnakeCase(original[keys[i]]);
        }
        else {
            snakeCased[newKey] = original[keys[i]];
        }
    }
    return snakeCased;
};
/**
 * Align enum
 */
export var EAlignOptions;
(function (EAlignOptions) {
    EAlignOptions["left"] = "left";
    EAlignOptions["right"] = "right";
    EAlignOptions["center"] = "center";
    EAlignOptions["bottom"] = "bottom";
    EAlignOptions["top"] = "top";
})(EAlignOptions || (EAlignOptions = {}));
/**
 * Align enum with faces option
 */
export var EAlignFacesOptions;
(function (EAlignFacesOptions) {
    EAlignFacesOptions["left"] = "left";
    EAlignFacesOptions["right"] = "right";
    EAlignFacesOptions["center"] = "center";
    EAlignFacesOptions["bottom"] = "bottom";
    EAlignFacesOptions["top"] = "top";
    EAlignFacesOptions["faces"] = "faces";
})(EAlignFacesOptions || (EAlignFacesOptions = {}));
/**
 * Fit enum
 */
export var EFitOptions;
(function (EFitOptions) {
    EFitOptions["clip"] = "clip";
    EFitOptions["crop"] = "crop";
    EFitOptions["scale"] = "scale";
    EFitOptions["max"] = "max";
})(EFitOptions || (EFitOptions = {}));
/**
 * Blur enum
 */
export var EBlurMode;
(function (EBlurMode) {
    EBlurMode["linear"] = "linear";
    EBlurMode["gaussian"] = "gaussian";
})(EBlurMode || (EBlurMode = {}));
/**
 * Shapes enum
 */
export var EShapeType;
(function (EShapeType) {
    EShapeType["oval"] = "oval";
    EShapeType["rect"] = "rect";
})(EShapeType || (EShapeType = {}));
/**
 * Noise type enum
 */
export var ENoiseType;
(function (ENoiseType) {
    ENoiseType["none"] = "none";
    ENoiseType["low"] = "low";
    ENoiseType["medium"] = "medium";
    ENoiseType["high"] = "high";
})(ENoiseType || (ENoiseType = {}));
/**
 * Style type enum
 */
export var EStyleType;
(function (EStyleType) {
    EStyleType["artwork"] = "artwork";
    EStyleType["photo"] = "photo";
})(EStyleType || (EStyleType = {}));
/**
 * Color space enum
 */
export var EColorspaceType;
(function (EColorspaceType) {
    EColorspaceType["RGB"] = "RGB";
    EColorspaceType["CMYK"] = "CMYK";
    EColorspaceType["Input"] = "Input";
})(EColorspaceType || (EColorspaceType = {}));
/**
 * Crop faces options enum
 */
export var ECropfacesType;
(function (ECropfacesType) {
    ECropfacesType["thumb"] = "thumb";
    ECropfacesType["crop"] = "crop";
    ECropfacesType["fill"] = "fill";
})(ECropfacesType || (ECropfacesType = {}));
/**
 * Convert to format
 */
export var EVideoTypes;
(function (EVideoTypes) {
    EVideoTypes["h264"] = "h264";
    EVideoTypes["h264_hi"] = "h264.hi";
    EVideoTypes["webm"] = "webm";
    EVideoTypes["webm-hi"] = "webm.hi";
    EVideoTypes["ogg"] = "ogg";
    EVideoTypes["ogg-hi"] = "ogg.hi";
    EVideoTypes["hls-variant"] = "hls.variant";
    EVideoTypes["mp3"] = "mp3";
    EVideoTypes["oga"] = "oga";
    EVideoTypes["m4a"] = "m4a";
    EVideoTypes["aac"] = "aac";
    EVideoTypes["hls"] = "hls.variant.audio";
})(EVideoTypes || (EVideoTypes = {}));
export var EUrlscreenshotAgent;
(function (EUrlscreenshotAgent) {
    EUrlscreenshotAgent["desktop"] = "desktop";
    EUrlscreenshotAgent["mobile"] = "mobile";
})(EUrlscreenshotAgent || (EUrlscreenshotAgent = {}));
export var EUrlscreenshotMode;
(function (EUrlscreenshotMode) {
    EUrlscreenshotMode["all"] = "all";
    EUrlscreenshotMode["window"] = "window";
})(EUrlscreenshotMode || (EUrlscreenshotMode = {}));
export var EUrlscreenshotOrientation;
(function (EUrlscreenshotOrientation) {
    EUrlscreenshotOrientation["portrait"] = "portrait";
    EUrlscreenshotOrientation["landscape"] = "landscape";
})(EUrlscreenshotOrientation || (EUrlscreenshotOrientation = {}));
/**
 * Video storage location
 */
export var EVideoLocations;
(function (EVideoLocations) {
    EVideoLocations["s3"] = "s3";
    EVideoLocations["azure"] = "azure";
    EVideoLocations["gcs"] = "gcs";
    EVideoLocations["rackspace"] = "rackspace";
    EVideoLocations["dropbox"] = "dropbox";
})(EVideoLocations || (EVideoLocations = {}));
export var EVideoAccess;
(function (EVideoAccess) {
    EVideoAccess["private"] = "private";
    EVideoAccess["public"] = "public";
})(EVideoAccess || (EVideoAccess = {}));
export var EVideoAccessMode;
(function (EVideoAccessMode) {
    EVideoAccessMode["preserve"] = "preserve";
    EVideoAccessMode["constrain"] = "constrain";
    EVideoAccessMode["letterbox"] = "letterbox";
    EVideoAccessMode["pad"] = "pad";
    EVideoAccessMode["crop"] = "crop";
})(EVideoAccessMode || (EVideoAccessMode = {}));
/**
 * Creates filestack transform url.
 * Transform params can be provided in camelCase or snakeCase style
 *
 * @example
 * ```js
 * // camelCase
 * console.log(transform(session, {
 *    partialPixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * ```js
 * // snake_case
 * console.log(transform(session, {
 *    partial_pixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * Client.transform is deprecated. Use Filelink class instead
 *
 * @private
 * @throws Error
 * @param options Transformation options
 * @param url url, handle or array of elements
 */
export var transform = function (session, url, options, b64) {
    if (options === void 0) { options = {}; }
    if (b64 === void 0) { b64 = false; }
    options = toSnakeCase(options);
    if (session.policy && session.signature) {
        options.security = {
            policy: session.policy,
            signature: session.signature,
        };
    }
    var filelink = new Filelink(url, session.apikey);
    filelink.setCname(session.cname);
    filelink.setBase64(b64);
    Object.keys(options).forEach(function (key) {
        if (typeof options[key] === 'boolean' && !options[key] && key !== 'cache') {
            return;
        }
        filelink.addTask(key, options[key]);
    });
    return filelink.toString();
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3RyYW5zZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFHSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXpDOztHQUVHO0FBQ0gsSUFBTSxXQUFXLEdBQUcsVUFBQyxRQUFrQztJQUNyRCxJQUFJLFVBQVUsR0FBNkIsRUFBRSxDQUFDO0lBRTlDLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFFbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDcEMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFaEUsSUFBSSxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzlFLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDckQ7YUFBTTtZQUNMLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDeEM7S0FDRjtJQUVELE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxDQUFOLElBQVksYUFNWDtBQU5ELFdBQVksYUFBYTtJQUN2Qiw4QkFBYSxDQUFBO0lBQ2IsZ0NBQWUsQ0FB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RCxJQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25ELFFBQVEsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFeEIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxHQUEyQjtRQUN2RCxJQUFJLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLEtBQUssT0FBTyxFQUFFO1lBQ3pFLE9BQU87U0FDUjtRQUVELFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDN0IsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9hcGkvdHJhbnNmb3JtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgMjAxOCBieSBGaWxlc3RhY2suXG4gKiBTb21lIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJy4uL2NsaWVudCc7XG5pbXBvcnQgeyBGaWxlbGluayB9IGZyb20gJy4vLi4vZmlsZWxpbmsnO1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmNvbnN0IHRvU25ha2VDYXNlID0gKG9yaWdpbmFsOiB7IFtpbmRleDogc3RyaW5nXTogYW55IH0pOiB7IFtpbmRleDogc3RyaW5nXTogYW55IH0gPT4ge1xuICBsZXQgc25ha2VDYXNlZDogeyBbaW5kZXg6IHN0cmluZ106IGFueSB9ID0ge307XG5cbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9yaWdpbmFsKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgbmV3S2V5ID0ga2V5c1tpXS5zcGxpdCgvKD89W0EtWl0pLykuam9pbignXycpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAodHlwZW9mIG9yaWdpbmFsW2tleXNbaV1dID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShvcmlnaW5hbFtrZXlzW2ldXSkpIHtcbiAgICAgIHNuYWtlQ2FzZWRbbmV3S2V5XSA9IHRvU25ha2VDYXNlKG9yaWdpbmFsW2tleXNbaV1dKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc25ha2VDYXNlZFtuZXdLZXldID0gb3JpZ2luYWxba2V5c1tpXV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHNuYWtlQ2FzZWQ7XG59O1xuXG4vKipcbiAqIEFsaWduIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUFsaWduT3B0aW9ucyB7XG4gIGxlZnQgPSAnbGVmdCcsXG4gIHJpZ2h0ID0gJ3JpZ2h0JyxcbiAgY2VudGVyID0gJ2NlbnRlcicsXG4gIGJvdHRvbSA9ICdib3R0b20nLFxuICB0b3AgPSAndG9wJyxcbn1cblxuLyoqXG4gKiBBbGlnbiBlbnVtIHdpdGggZmFjZXMgb3B0aW9uXG4gKi9cbmV4cG9ydCBlbnVtIEVBbGlnbkZhY2VzT3B0aW9ucyB7XG4gIGxlZnQgPSAnbGVmdCcsXG4gIHJpZ2h0ID0gJ3JpZ2h0JyxcbiAgY2VudGVyID0gJ2NlbnRlcicsXG4gIGJvdHRvbSA9ICdib3R0b20nLFxuICB0b3AgPSAndG9wJyxcbiAgZmFjZXMgPSAnZmFjZXMnLFxufVxuXG4vKipcbiAqIEZpdCBlbnVtXG4gKi9cbmV4cG9ydCBlbnVtIEVGaXRPcHRpb25zIHtcbiAgY2xpcCA9ICdjbGlwJyxcbiAgY3JvcCA9ICdjcm9wJyxcbiAgc2NhbGUgPSAnc2NhbGUnLFxuICBtYXggPSAnbWF4Jyxcbn1cblxuLyoqXG4gKiBCbHVyIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUJsdXJNb2RlIHtcbiAgbGluZWFyID0gJ2xpbmVhcicsXG4gIGdhdXNzaWFuID0gJ2dhdXNzaWFuJyxcbn1cblxuLyoqXG4gKiBTaGFwZXMgZW51bVxuICovXG5leHBvcnQgZW51bSBFU2hhcGVUeXBlIHtcbiAgb3ZhbCA9ICdvdmFsJyxcbiAgcmVjdCA9ICdyZWN0Jyxcbn1cblxuLyoqXG4gKiBOb2lzZSB0eXBlIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRU5vaXNlVHlwZSB7XG4gIG5vbmUgPSAnbm9uZScsXG4gIGxvdyA9ICdsb3cnLFxuICBtZWRpdW0gPSAnbWVkaXVtJyxcbiAgaGlnaCA9ICdoaWdoJyxcbn1cblxuLyoqXG4gKiBTdHlsZSB0eXBlIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRVN0eWxlVHlwZSB7XG4gIGFydHdvcmsgPSAnYXJ0d29yaycsXG4gIHBob3RvID0gJ3Bob3RvJyxcbn1cblxuLyoqXG4gKiBDb2xvciBzcGFjZSBlbnVtXG4gKi9cbmV4cG9ydCBlbnVtIEVDb2xvcnNwYWNlVHlwZSB7XG4gIFJHQiA9ICdSR0InLFxuICBDTVlLID0gJ0NNWUsnLFxuICBJbnB1dCA9ICdJbnB1dCcsXG59XG5cbi8qKlxuICogQ3JvcCBmYWNlcyBvcHRpb25zIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUNyb3BmYWNlc1R5cGUge1xuICB0aHVtYiA9ICd0aHVtYicsXG4gIGNyb3AgPSAnY3JvcCcsXG4gIGZpbGwgPSAnZmlsbCcsXG59XG5cbi8qKlxuICogQ29udmVydCB0byBmb3JtYXRcbiAqL1xuZXhwb3J0IGVudW0gRVZpZGVvVHlwZXMge1xuICAgIGgyNjQgPSAnaDI2NCcsXG4gICAgaDI2NF9oaSA9ICdoMjY0LmhpJyxcbiAgICB3ZWJtID0gJ3dlYm0nLFxuICAgICd3ZWJtLWhpJyA9ICd3ZWJtLmhpJyxcbiAgICBvZ2cgPSAnb2dnJyxcbiAgICAnb2dnLWhpJyA9ICdvZ2cuaGknLFxuICAgICdobHMtdmFyaWFudCcgPSAnaGxzLnZhcmlhbnQnLFxuICAgIG1wMyA9ICdtcDMnLFxuICAgIG9nYSA9ICdvZ2EnLFxuICAgIG00YSA9ICdtNGEnLFxuICAgIGFhYyA9ICdhYWMnLFxuICAgIGhscyA9ICdobHMudmFyaWFudC5hdWRpbycsXG59XG5cbmV4cG9ydCBlbnVtIEVVcmxzY3JlZW5zaG90QWdlbnQge1xuICBkZXNrdG9wID0gJ2Rlc2t0b3AnLFxuICBtb2JpbGUgPSAnbW9iaWxlJyxcbn1cblxuZXhwb3J0IGVudW0gRVVybHNjcmVlbnNob3RNb2RlIHtcbiAgYWxsID0gJ2FsbCcsXG4gIHdpbmRvdyA9ICd3aW5kb3cnLFxufVxuXG5leHBvcnQgZW51bSBFVXJsc2NyZWVuc2hvdE9yaWVudGF0aW9uIHtcbiAgcG9ydHJhaXQgPSAncG9ydHJhaXQnLFxuICBsYW5kc2NhcGUgPSAnbGFuZHNjYXBlJyxcbn1cblxuLyoqXG4gKiBWaWRlbyBzdG9yYWdlIGxvY2F0aW9uXG4gKi9cbmV4cG9ydCBlbnVtIEVWaWRlb0xvY2F0aW9ucyB7XG4gIHMzID0gJ3MzJyxcbiAgYXp1cmUgPSAnYXp1cmUnLFxuICBnY3MgPSAnZ2NzJyxcbiAgcmFja3NwYWNlID0gJ3JhY2tzcGFjZScsXG4gIGRyb3Bib3ggPSAnZHJvcGJveCcsXG59XG5cbmV4cG9ydCBlbnVtIEVWaWRlb0FjY2VzcyB7XG4gIHByaXZhdGUgPSAncHJpdmF0ZScsXG4gIHB1YmxpYyA9ICdwdWJsaWMnLFxufVxuXG5leHBvcnQgZW51bSBFVmlkZW9BY2Nlc3NNb2RlIHtcbiAgcHJlc2VydmUgPSAncHJlc2VydmUnLFxuICBjb25zdHJhaW4gPSAnY29uc3RyYWluJyxcbiAgbGV0dGVyYm94ID0gJ2xldHRlcmJveCcsXG4gIHBhZCA9ICdwYWQnLFxuICBjcm9wID0gJ2Nyb3AnLFxufVxuXG4vKipcbiAqIEBzZWUgaHR0cHM6Ly93d3cuZmlsZXN0YWNrLmNvbS9kb2NzL2ltYWdlLXRyYW5zZm9ybWF0aW9uc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZm9ybU9wdGlvbnMge1xuICBmbGlwPzogYm9vbGVhbjtcbiAgY29tcHJlc3M/OiBib29sZWFuO1xuICBmbG9wPzogYm9vbGVhbjtcbiAgZW5jaGFuY2U/OiBib29sZWFuO1xuICByZWRleWU/OiBib29sZWFuO1xuICBtb25vY2hyb21lPzogYm9vbGVhbjtcbiAgbmVnYXRpdmU/OiBib29sZWFuO1xuICB0YWdzPzogYm9vbGVhbjtcbiAgc2Z3PzogYm9vbGVhbjtcbiAgc3RvcmU/OiB7XG4gICAgZmlsZW5hbWU/OiBzdHJpbmcsXG4gICAgbG9jYXRpb24/OiBzdHJpbmcsXG4gICAgcGF0aD86IHN0cmluZyxcbiAgICBjb250YWluZXI/OiBzdHJpbmcsXG4gICAgcmVnaW9uPzogc3RyaW5nO1xuICAgIGFjY2Vzcz86IHN0cmluZztcbiAgICBiYXNlNjRkZWNvZGU/OiBib29sZWFuO1xuICB9O1xuICByZXNpemU/OiB7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIGZpdD86IEVGaXRPcHRpb25zO1xuICAgIGFsaWduPzogRUFsaWduRmFjZXNPcHRpb25zO1xuICB9O1xuICBjcm9wPzoge1xuICAgIGRpbTogW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl1cbiAgfTtcbiAgcm90YXRlPzoge1xuICAgIGRlZzogbnVtYmVyIHwgc3RyaW5nO1xuICAgIGNvbG9yPzogc3RyaW5nO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH07XG4gIGRldGVjdF9mYWNlcz86IHtcbiAgICBtaW5zaXplPzogbnVtYmVyO1xuICAgIG1heHNpemU/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgZXhwb3J0PzogYm9vbGVhbjtcbiAgfSB8IHRydWU7XG4gIGNyb3BfZmFjZXM/OiB7XG4gICAgbW9kZT86IEVDcm9wZmFjZXNUeXBlO1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICBmYWNlcz86IG51bWJlciB8IHN0cmluZztcbiAgICBidWZmZXI/OiBudW1iZXI7XG4gIH07XG4gIHBpeGVsYXRlX2ZhY2VzPzoge1xuICAgIGZhY2VzPzogbnVtYmVyIHwgc3RyaW5nO1xuICAgIG1pbnNpemU/OiBudW1iZXI7XG4gICAgbWF4c2l6ZT86IG51bWJlcjtcbiAgICBidWZmZXI/OiBudW1iZXI7XG4gICAgYW1vdW50PzogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgdHlwZT86IEVTaGFwZVR5cGU7XG4gIH07XG4gIGJsdXJfZmFjZXM/OiB7XG4gICAgZmFjZXM/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgbWluc2l6ZT86IG51bWJlcjtcbiAgICBtYXhzaXplPzogbnVtYmVyO1xuICAgIGJ1ZmZlcj86IG51bWJlcjtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cj86IG51bWJlcjtcbiAgICB0eXBlPzogRVNoYXBlVHlwZTtcbiAgfTtcbiAgcm91bmRlZF9jb3JuZXJzPzoge1xuICAgIHJhZGl1cz86IG51bWJlcjtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICB2aWduZXR0ZT86IHtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cm1vZGU/OiBFQmx1ck1vZGU7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfTtcbiAgcG9sYXJvaWQ/OiB7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgcm90YXRlPzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICB0b3JuX2VkZ2VzPzoge1xuICAgIHNwcmVhZD86IFtudW1iZXIsIG51bWJlcl07XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHNoYWRvdz86IHtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIG9wYWNpdHk/OiBudW1iZXI7XG4gICAgdmVjdG9yPzogW251bWJlciwgbnVtYmVyXTtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICB9IHwgdHJ1ZTtcbiAgY2lyY2xlPzoge1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICBib3JkZXI/OiB7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHNoYXJwZW4/OiB7XG4gICAgYW1vdW50OiBudW1iZXI7XG4gIH0gfCB0cnVlO1xuICBibHVyPzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgYmxhY2t3aGl0ZT86IHtcbiAgICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHNlcGlhPzoge1xuICAgIHRvbmU6IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHBpeGVsYXRlPzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgb2lsX3BhaW50Pzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgbW9kdWxhdGU/OiB7XG4gICAgYnJpZ2h0bmVzcz86IG51bWJlcjtcbiAgICBodWU/OiBudW1iZXI7XG4gICAgc2F0dXJhdGlvbj86IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHBhcnRpYWxfcGl4ZWxhdGU/OiB7XG4gICAgYW1vdW50PzogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgdHlwZT86IEVTaGFwZVR5cGU7XG4gICAgb2JqZWN0cz86IFtbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXV07XG4gIH07XG4gIHBhcnRpYWxfYmx1cj86IHtcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIHR5cGU/OiBFU2hhcGVUeXBlO1xuICAgIG9iamVjdHM/OiBbW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl1dO1xuICB9O1xuICBjb2xsYWdlPzoge1xuICAgIG1hcmdpbj86IG51bWJlcjtcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgZml0PzogRUZpdE9wdGlvbnMsXG4gICAgZmlsZXM6IFtzdHJpbmddO1xuICB9O1xuICB1cHNjYWxlPzoge1xuICAgIHVwc2NhbGU/OiBib29sZWFuO1xuICAgIG5vaXNlPzogRU5vaXNlVHlwZTtcbiAgICBzdHlsZT86IEVTdHlsZVR5cGU7XG4gIH0gfCB0cnVlO1xuICBhc2NpaT86IHtcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICAgIGZvcmVncm91bmQ/OiBzdHJpbmc7XG4gICAgY29sb3JlZD86IGJvb2xlYW47XG4gICAgc2l6ZT86IG51bWJlcjtcbiAgICByZXZlcnNlPzogYm9vbGVhbjtcbiAgfSB8IHRydWU7XG4gIHF1YWxpdHk/OiB7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgfTtcbiAgc2VjdXJpdHk/OiB7XG4gICAgcG9saWN5OiBzdHJpbmc7XG4gICAgc2lnbmF0dXJlPzogc3RyaW5nO1xuICB9O1xuICBvdXRwdXQ/OiB7XG4gICAgZm9ybWF0OiBzdHJpbmc7XG4gICAgY29sb3JzcGFjZT86IHN0cmluZztcbiAgICBzdHJpcD86IGJvb2xlYW47XG4gICAgcXVhbGl0eT86IG51bWJlcjtcbiAgICBwYWdlPzogbnVtYmVyO1xuICAgIGNvbXByZXNzPzogYm9vbGVhbjtcbiAgICBkZW5zaXR5PzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gICAgc2VjdXJlPzogYm9vbGVhbjtcbiAgICBkb2NpbmZvPzogYm9vbGVhbjtcbiAgICBwYWdlZm9ybWF0Pzogc3RyaW5nO1xuICAgIHBhZ2VvcmllbnRhdGlvbj86IHN0cmluZztcbiAgfTtcbiAgY2FjaGU/OiB7XG4gICAgY2FjaGU/OiBib29sZWFuO1xuICAgIGV4cGlyeTogbnVtYmVyO1xuICB9O1xuICAvLyBhdWRpby92aWRlb1xuICB2aWRlb19jb252ZXJ0Pzoge1xuICAgIGFzcGVjdF9tb2RlOiBFVmlkZW9BY2Nlc3NNb2RlO1xuICAgIHByZXNldD86IEVWaWRlb1R5cGVzO1xuICAgIGZvcmNlPzogYm9vbGVhbjtcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICBleHRuYW1lPzogc3RyaW5nO1xuICAgIGZpbGVuYW1lPzogc3RyaW5nO1xuICAgIGxvY2F0aW9uPzogRVZpZGVvTG9jYXRpb25zO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgYWNjZXNzPzogRVZpZGVvQWNjZXNzO1xuICAgIGNvbnRhaW5lcj86IHN0cmluZztcbiAgICBhdWRpb19iaXRyYXRlPzogbnVtYmVyO1xuICAgIHVwc2NhbGU6IGJvb2xlYW47XG4gICAgdmlkZW9fYml0cmF0ZT86IG51bWJlcjtcbiAgICBhdWRpb19zYW1wbGVfcmF0ZT86IG51bWJlcjtcbiAgICBhdWRpb19jaGFubmVscz86IG51bWJlcjtcbiAgICBjbGlwX2xlbmd0aD86IHN0cmluZztcbiAgICBjbGlwX29mZnNldD86IHN0cmluZztcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgdHdvX3Bhc3M/OiBib29sZWFuO1xuICAgIGZwcz86IG51bWJlcjtcbiAgICBrZXlmcmFtZV9pbnRlcnZhbD86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfdXJsPzogc3RyaW5nO1xuICAgIHdhdGVybWFya190b3A/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX2JvdHRvbT86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfcmlnaHQ/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX2xlZnQ/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX3dpZHRoPzogbnVtYmVyO1xuICAgIHdhdGVybWFya19oZWlnaHQ/OiBudW1iZXI7XG4gIH07XG4gIHVybHNjcmVlbnNob3Q/OiB7XG4gICAgYWdlbnQ/OiBFVXJsc2NyZWVuc2hvdEFnZW50O1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICBtb2RlPzogRVVybHNjcmVlbnNob3RNb2RlO1xuICAgIGRlbGF5PzogbnVtYmVyO1xuICAgIG9yaWVudGF0aW9uPzogRVVybHNjcmVlbnNob3RPcmllbnRhdGlvbjtcbiAgICBkZXZpY2U/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICBwZGZpbmZvPzoge1xuICAgIGNvbG9yaW5mbz86IGJvb2xlYW5cbiAgfSB8IHRydWU7XG4gIHBkZmNvbnZlcnQ/OiB7XG4gICAgcGFnZW9yaWVudGF0aW9uPzogc3RyaW5nXG4gICAgcGFnZWZvcm1hdD86IHN0cmluZ1xuICAgIHBhZ2VzPzogKHN0cmluZyB8IG51bWJlcilbXVxuICB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgZmlsZXN0YWNrIHRyYW5zZm9ybSB1cmwuXG4gKiBUcmFuc2Zvcm0gcGFyYW1zIGNhbiBiZSBwcm92aWRlZCBpbiBjYW1lbENhc2Ugb3Igc25ha2VDYXNlIHN0eWxlXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiAvLyBjYW1lbENhc2VcbiAqIGNvbnNvbGUubG9nKHRyYW5zZm9ybShzZXNzaW9uLCB7XG4gKiAgICBwYXJ0aWFsUGl4ZWxhdGU6IHtcbiAqICAgICAgb2JqZWN0czogW1sxMCwgMjAsIDIwMCwgMjUwXSwgWzI3NSwgOTEsIDUwMCwgNTU3XV0sXG4gKiAgICB9LFxuICogIH0sICd0ZXN0ZmlsZScpKTtcbiAqIGBgYFxuICogcmVzdWx0ID0+IGh0dHBzOi8vY2RuLmZpbGVzdGFja2NvbnRlbnQuY29tL3BhcnRpYWxfcGl4ZWxhdGU9b2JqZWN0czpbWzEwLDIwLDIwMCwyNTBdLFsyNzUsOTEsNTAwLDU1N11dL3Rlc3RmaWxlXG4gKlxuICogYGBganNcbiAqIC8vIHNuYWtlX2Nhc2VcbiAqIGNvbnNvbGUubG9nKHRyYW5zZm9ybShzZXNzaW9uLCB7XG4gKiAgICBwYXJ0aWFsX3BpeGVsYXRlOiB7XG4gKiAgICAgIG9iamVjdHM6IFtbMTAsIDIwLCAyMDAsIDI1MF0sIFsyNzUsIDkxLCA1MDAsIDU1N11dLFxuICogICAgfSxcbiAqICB9LCAndGVzdGZpbGUnKSk7XG4gKiBgYGBcbiAqIHJlc3VsdCA9PiBodHRwczovL2Nkbi5maWxlc3RhY2tjb250ZW50LmNvbS9wYXJ0aWFsX3BpeGVsYXRlPW9iamVjdHM6W1sxMCwyMCwyMDAsMjUwXSxbMjc1LDkxLDUwMCw1NTddXS90ZXN0ZmlsZVxuICpcbiAqIENsaWVudC50cmFuc2Zvcm0gaXMgZGVwcmVjYXRlZC4gVXNlIEZpbGVsaW5rIGNsYXNzIGluc3RlYWRcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHRocm93cyBFcnJvclxuICogQHBhcmFtIG9wdGlvbnMgVHJhbnNmb3JtYXRpb24gb3B0aW9uc1xuICogQHBhcmFtIHVybCB1cmwsIGhhbmRsZSBvciBhcnJheSBvZiBlbGVtZW50c1xuICovXG5leHBvcnQgY29uc3QgdHJhbnNmb3JtID0gKHNlc3Npb246IFNlc3Npb24sIHVybDogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnM6IFRyYW5zZm9ybU9wdGlvbnMgPSB7fSwgYjY0OiBib29sZWFuID0gZmFsc2UpOiBzdHJpbmcgPT4ge1xuICBvcHRpb25zID0gdG9TbmFrZUNhc2Uob3B0aW9ucyk7XG5cbiAgaWYgKHNlc3Npb24ucG9saWN5ICYmIHNlc3Npb24uc2lnbmF0dXJlKSB7XG4gICAgb3B0aW9ucy5zZWN1cml0eSA9IHtcbiAgICAgIHBvbGljeTogc2Vzc2lvbi5wb2xpY3ksXG4gICAgICBzaWduYXR1cmU6IHNlc3Npb24uc2lnbmF0dXJlLFxuICAgIH07XG4gIH1cblxuICBjb25zdCBmaWxlbGluayA9IG5ldyBGaWxlbGluayh1cmwsIHNlc3Npb24uYXBpa2V5KTtcbiAgZmlsZWxpbmsuc2V0Q25hbWUoc2Vzc2lvbi5jbmFtZSk7XG4gIGZpbGVsaW5rLnNldEJhc2U2NChiNjQpO1xuXG4gIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZvckVhY2goKGtleToga2V5b2YgVHJhbnNmb3JtT3B0aW9ucykgPT4ge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9uc1trZXldID09PSAnYm9vbGVhbicgJiYgIW9wdGlvbnNba2V5XSAmJiBrZXkgIT09ICdjYWNoZScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmaWxlbGluay5hZGRUYXNrKGtleSwgb3B0aW9uc1trZXldKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGZpbGVsaW5rLnRvU3RyaW5nKCk7XG59O1xuIl19
