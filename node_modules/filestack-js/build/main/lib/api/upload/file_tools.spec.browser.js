"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
/*
 * Copyright (c) 2019 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var file_tools_1 = require("./file_tools");
var utils = require("./../../utils");
var createFile = function (size, name, type) {
    if (size === void 0) { size = 44320; }
    if (name === void 0) { name = 'test.png'; }
    if (type === void 0) { type = 'image/png'; }
    return new File([new ArrayBuffer(size)], name, { type: type });
};
var sanitizeOptions = jest.fn().mockName('sanitizeOptions');
var base64Svg = 'PHN2ZyBoZWlnaHQ9IjEwMCIgd2lkdGg9IjEwMCI+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgZmlsbD0icmVkIiAvPgogIFNvcnJ5LCB5b3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBpbmxpbmUgU1ZHLiAgCjwvc3ZnPiA=';
var base64Png = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
var base64Gif = 'R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
describe('Api/Upload/FileTools', function () {
    beforeAll(function () {
        spyOn(utils, 'sanitizeName').and.callFake(function (val, opts) {
            sanitizeOptions(opts);
            return val;
        });
    });
    describe('getFileBrowser', function () {
        it('Should handle base64 encoded string (svg)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, file_tools_1.getFile({
                                file: base64Svg,
                                name: 'test.svg',
                            })];
                    case 1: return [2 /*return*/, _a.apply(void 0, [(_b.sent()).mimetype]).toEqual('image/svg+xml')];
                }
            });
        }); });
        it('Should handle base64 encoded string (png)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, file_tools_1.getFile(base64Png)];
                    case 1: return [2 /*return*/, _a.apply(void 0, [(_b.sent()).mimetype]).toEqual('image/png')];
                }
            });
        }); });
        it('Should handle base64 encoded string (gif)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, file_tools_1.getFile(base64Gif)];
                    case 1: return [2 /*return*/, _a.apply(void 0, [(_b.sent()).mimetype]).toEqual('image/gif')];
                }
            });
        }); });
        it('Should handle base64 encoded string with b64 prefix (gif)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, file_tools_1.getFile("data:image/gif;base64," + base64Gif)];
                    case 1: return [2 /*return*/, _a.apply(void 0, [(_b.sent()).mimetype]).toEqual('image/gif')];
                }
            });
        }); });
        it('Should pass sanitize options to file instance', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var soptions, fileRes;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        soptions = {
                            replacement: '=',
                        };
                        return [4 /*yield*/, file_tools_1.getFile({
                                file: base64Png,
                                name: 'test<.jpg',
                            }, soptions)];
                    case 1:
                        fileRes = _a.sent();
                        expect(sanitizeOptions).toHaveBeenCalledWith(soptions);
                        return [2 /*return*/];
                }
            });
        }); });
        it('Should throw error when random string is provided', function () {
            return expect(file_tools_1.getFile('asdasdfasdf')).rejects.toEqual(new Error('Unsupported input file type'));
        });
        it('Should handle base64 named file (gif)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var file;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, file_tools_1.getFile({
                            file: base64Gif,
                            name: 'test.gif',
                        })];
                    case 1:
                        file = _a.sent();
                        expect(file.mimetype).toEqual('image/gif');
                        expect(file.name).toEqual('test.gif');
                        return [2 /*return*/];
                }
            });
        }); });
        it('Should handle File input type', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var file;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, file_tools_1.getFile(createFile())];
                    case 1:
                        file = _a.sent();
                        expect(file.mimetype).toEqual('image/png');
                        expect(file.name).toEqual('test.png');
                        expect(file.size).toEqual(44320);
                        return [2 /*return*/];
                }
            });
        }); });
        it('Should handle blob input type', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var file;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, file_tools_1.getFile(new Blob([new ArrayBuffer(100)], {
                            type: 'image/jpg',
                        }))];
                    case 1:
                        file = _a.sent();
                        expect(file.mimetype).toEqual('image/jpg');
                        expect(file.name).toEqual(undefined);
                        expect(file.size).toEqual(100);
                        return [2 /*return*/];
                }
            });
        }); });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3VwbG9hZC9maWxlX3Rvb2xzLnNwZWMuYnJvd3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFDSCwyQ0FBdUM7QUFDdkMscUNBQXVDO0FBRXZDLElBQU0sVUFBVSxHQUFHLFVBQUMsSUFBWSxFQUFFLElBQWlCLEVBQUUsSUFBa0I7SUFBbkQscUJBQUEsRUFBQSxZQUFZO0lBQUUscUJBQUEsRUFBQSxpQkFBaUI7SUFBRSxxQkFBQSxFQUFBLGtCQUFrQjtJQUFLLE9BQUEsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQztBQUF4RCxDQUF3RCxDQUFDO0FBRXJJLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUU5RCxJQUFNLFNBQVMsR0FBRyxzT0FBc08sQ0FBQztBQUN6UCxJQUFNLFNBQVMsR0FBRyxrR0FBa0csQ0FBQztBQUNySCxJQUFNLFNBQVMsR0FBRyw4REFBOEQsQ0FBQztBQUVqRixRQUFRLENBQUMsc0JBQXNCLEVBQUU7SUFDL0IsU0FBUyxDQUFDO1FBQ1IsS0FBSyxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLFVBQUMsR0FBRyxFQUFFLElBQUk7WUFDbEQsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRTtRQUV6QixFQUFFLENBQUMsMkNBQTJDLEVBQUU7Ozs7O3dCQUN2QyxLQUFBLE1BQU0sQ0FBQTt3QkFBRSxxQkFBTSxvQkFBTyxDQUFDO2dDQUMzQixJQUFJ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QUFPLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFOzRCQUMxRCxJQUFJLEVBQUUsV0FBVzt5QkFDbEIsQ0FBQyxDQUFDLEVBQUE7O3dCQUZHLElBQUksR0FBRyxTQUVWO3dCQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUMzQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQzt3QkFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7YUFDaEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJsaWIvYXBpL3VwbG9hZC9maWxlX3Rvb2xzLnNwZWMuYnJvd3Nlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgYnkgRmlsZXN0YWNrLlxuICogU29tZSByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICdMaWNlbnNlJyk7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IGdldEZpbGUgfSBmcm9tICcuL2ZpbGVfdG9vbHMnO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi8uLi8uLi91dGlscyc7XG5cbmNvbnN0IGNyZWF0ZUZpbGUgPSAoc2l6ZSA9IDQ0MzIwLCBuYW1lID0gJ3Rlc3QucG5nJywgdHlwZSA9ICdpbWFnZS9wbmcnKSA9PiBuZXcgRmlsZShbbmV3IEFycmF5QnVmZmVyKHNpemUpXSwgbmFtZSAsIHsgdHlwZTogdHlwZSB9KTtcblxuY29uc3Qgc2FuaXRpemVPcHRpb25zID0gamVzdC5mbigpLm1vY2tOYW1lKCdzYW5pdGl6ZU9wdGlvbnMnKTtcblxuY29uc3QgYmFzZTY0U3ZnID0gJ1BITjJaeUJvWldsbmFIUTlJakV3TUNJZ2QybGtkR2c5SWpFd01DSStDaUFnUEdOcGNtTnNaU0JqZUQwaU5UQWlJR041UFNJMU1DSWdjajBpTkRBaUlITjBjbTlyWlQwaVlteGhZMnNpSUhOMGNtOXJaUzEzYVdSMGFEMGlNeUlnWm1sc2JEMGljbVZrSWlBdlBnb2dJRk52Y25KNUxDQjViM1Z5SUdKeWIzZHpaWElnWkc5bGN5QnViM1FnYzNWd2NHOXlkQ0JwYm14cGJtVWdVMVpITGlBZ0Nqd3ZjM1puUGlBPSc7XG5jb25zdCBiYXNlNjRQbmcgPSAnaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUFFQUFBQUJDQVlBQUFBZkZjU0pBQUFBRFVsRVFWUjQybU5rK005UUR3QURoZ0dBV2pSOWF3QUFBQUJKUlU1RXJrSmdnZz09JztcbmNvbnN0IGJhc2U2NEdpZiA9ICdSMGxHT0RsaEFRQUJBSUFBQVAvLy93QUFBQ0g1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlDUkFFQU93PT0nO1xuXG5kZXNjcmliZSgnQXBpL1VwbG9hZC9GaWxlVG9vbHMnLCAoKSA9PiB7XG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgc3B5T24odXRpbHMsICdzYW5pdGl6ZU5hbWUnKS5hbmQuY2FsbEZha2UoKHZhbCwgb3B0cykgPT4ge1xuICAgICAgc2FuaXRpemVPcHRpb25zKG9wdHMpO1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEZpbGVCcm93c2VyJywgKCkgPT4ge1xuXG4gICAgaXQoJ1Nob3VsZCBoYW5kbGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nIChzdmcpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGV4cGVjdCgoYXdhaXQgZ2V0RmlsZSh7XG4gICAgICAgIGZpbGU6IGJhc2U2NFN2ZyxcbiAgICAgICAgbmFtZTogJ3Rlc3Quc3ZnJyxcbiAgICAgIH0pKS5taW1ldHlwZSkudG9FcXVhbCgnaW1hZ2Uvc3ZnK3htbCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBoYW5kbGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nIChwbmcpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGV4cGVjdCgoYXdhaXQgZ2V0RmlsZShiYXNlNjRQbmcpKS5taW1ldHlwZSkudG9FcXVhbCgnaW1hZ2UvcG5nJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGhhbmRsZSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgKGdpZiknLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZXhwZWN0KChhd2FpdCBnZXRGaWxlKGJhc2U2NEdpZikpLm1pbWV0eXBlKS50b0VxdWFsKCdpbWFnZS9naWYnKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgaGFuZGxlIGJhc2U2NCBlbmNvZGVkIHN0cmluZyB3aXRoIGI2NCBwcmVmaXggKGdpZiknLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZXhwZWN0KChhd2FpdCBnZXRGaWxlKGBkYXRhOmltYWdlL2dpZjtiYXNlNjQsJHtiYXNlNjRHaWZ9YCkpLm1pbWV0eXBlKS50b0VxdWFsKCdpbWFnZS9naWYnKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgcGFzcyBzYW5pdGl6ZSBvcHRpb25zIHRvIGZpbGUgaW5zdGFuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzb3B0aW9ucyA9IHtcbiAgICAgICAgcmVwbGFjZW1lbnQ6ICc9JyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGZpbGVSZXMgPSBhd2FpdCBnZXRGaWxlKHtcbiAgICAgICAgZmlsZTogYmFzZTY0UG5nLFxuICAgICAgICBuYW1lOiAndGVzdDwuanBnJyxcbiAgICAgIH0sIHNvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KHNhbml0aXplT3B0aW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoc29wdGlvbnMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHJhbmRvbSBzdHJpbmcgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICByZXR1cm4gZXhwZWN0KGdldEZpbGUoJ2FzZGFzZGZhc2RmJykpLnJlamVjdHMudG9FcXVhbChuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGlucHV0IGZpbGUgdHlwZScpKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgaGFuZGxlIGJhc2U2NCBuYW1lZCBmaWxlIChnaWYpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IGdldEZpbGUoe1xuICAgICAgICBmaWxlOiBiYXNlNjRHaWYsXG4gICAgICAgIG5hbWU6ICd0ZXN0LmdpZicsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChmaWxlLm1pbWV0eXBlKS50b0VxdWFsKCdpbWFnZS9naWYnKTtcbiAgICAgIGV4cGVjdChmaWxlLm5hbWUpLnRvRXF1YWwoJ3Rlc3QuZ2lmJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGhhbmRsZSBGaWxlIGlucHV0IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gYXdhaXQgZ2V0RmlsZShjcmVhdGVGaWxlKCkpO1xuICAgICAgZXhwZWN0KGZpbGUubWltZXR5cGUpLnRvRXF1YWwoJ2ltYWdlL3BuZycpO1xuICAgICAgZXhwZWN0KGZpbGUubmFtZSkudG9FcXVhbCgndGVzdC5wbmcnKTtcbiAgICAgIGV4cGVjdChmaWxlLnNpemUpLnRvRXF1YWwoNDQzMjApO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBoYW5kbGUgYmxvYiBpbnB1dCB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IGdldEZpbGUobmV3IEJsb2IoW25ldyBBcnJheUJ1ZmZlcigxMDApXSwge1xuICAgICAgICB0eXBlOiAnaW1hZ2UvanBnJyxcbiAgICAgIH0pKTtcblxuICAgICAgZXhwZWN0KGZpbGUubWltZXR5cGUpLnRvRXF1YWwoJ2ltYWdlL2pwZycpO1xuICAgICAgZXhwZWN0KGZpbGUubmFtZSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGZpbGUuc2l6ZSkudG9FcXVhbCgxMDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19
