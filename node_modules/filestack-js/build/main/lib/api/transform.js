"use strict";
/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var filelink_1 = require("./../filelink");
/**
 * @private
 */
var toSnakeCase = function (original) {
    var snakeCased = {};
    var keys = Object.keys(original);
    for (var i = 0; i < keys.length; i++) {
        var newKey = keys[i].split(/(?=[A-Z])/).join('_').toLowerCase();
        if (typeof original[keys[i]] === 'object' && !Array.isArray(original[keys[i]])) {
            snakeCased[newKey] = toSnakeCase(original[keys[i]]);
        }
        else {
            snakeCased[newKey] = original[keys[i]];
        }
    }
    return snakeCased;
};
/**
 * Align enum
 */
var EAlignOptions;
(function (EAlignOptions) {
    EAlignOptions["left"] = "left";
    EAlignOptions["right"] = "right";
    EAlignOptions["center"] = "center";
    EAlignOptions["bottom"] = "bottom";
    EAlignOptions["top"] = "top";
})(EAlignOptions = exports.EAlignOptions || (exports.EAlignOptions = {}));
/**
 * Align enum with faces option
 */
var EAlignFacesOptions;
(function (EAlignFacesOptions) {
    EAlignFacesOptions["left"] = "left";
    EAlignFacesOptions["right"] = "right";
    EAlignFacesOptions["center"] = "center";
    EAlignFacesOptions["bottom"] = "bottom";
    EAlignFacesOptions["top"] = "top";
    EAlignFacesOptions["faces"] = "faces";
})(EAlignFacesOptions = exports.EAlignFacesOptions || (exports.EAlignFacesOptions = {}));
/**
 * Fit enum
 */
var EFitOptions;
(function (EFitOptions) {
    EFitOptions["clip"] = "clip";
    EFitOptions["crop"] = "crop";
    EFitOptions["scale"] = "scale";
    EFitOptions["max"] = "max";
})(EFitOptions = exports.EFitOptions || (exports.EFitOptions = {}));
/**
 * Blur enum
 */
var EBlurMode;
(function (EBlurMode) {
    EBlurMode["linear"] = "linear";
    EBlurMode["gaussian"] = "gaussian";
})(EBlurMode = exports.EBlurMode || (exports.EBlurMode = {}));
/**
 * Shapes enum
 */
var EShapeType;
(function (EShapeType) {
    EShapeType["oval"] = "oval";
    EShapeType["rect"] = "rect";
})(EShapeType = exports.EShapeType || (exports.EShapeType = {}));
/**
 * Noise type enum
 */
var ENoiseType;
(function (ENoiseType) {
    ENoiseType["none"] = "none";
    ENoiseType["low"] = "low";
    ENoiseType["medium"] = "medium";
    ENoiseType["high"] = "high";
})(ENoiseType = exports.ENoiseType || (exports.ENoiseType = {}));
/**
 * Style type enum
 */
var EStyleType;
(function (EStyleType) {
    EStyleType["artwork"] = "artwork";
    EStyleType["photo"] = "photo";
})(EStyleType = exports.EStyleType || (exports.EStyleType = {}));
/**
 * Color space enum
 */
var EColorspaceType;
(function (EColorspaceType) {
    EColorspaceType["RGB"] = "RGB";
    EColorspaceType["CMYK"] = "CMYK";
    EColorspaceType["Input"] = "Input";
})(EColorspaceType = exports.EColorspaceType || (exports.EColorspaceType = {}));
/**
 * Crop faces options enum
 */
var ECropfacesType;
(function (ECropfacesType) {
    ECropfacesType["thumb"] = "thumb";
    ECropfacesType["crop"] = "crop";
    ECropfacesType["fill"] = "fill";
})(ECropfacesType = exports.ECropfacesType || (exports.ECropfacesType = {}));
/**
 * Convert to format
 */
var EVideoTypes;
(function (EVideoTypes) {
    EVideoTypes["h264"] = "h264";
    EVideoTypes["h264_hi"] = "h264.hi";
    EVideoTypes["webm"] = "webm";
    EVideoTypes["webm-hi"] = "webm.hi";
    EVideoTypes["ogg"] = "ogg";
    EVideoTypes["ogg-hi"] = "ogg.hi";
    EVideoTypes["hls-variant"] = "hls.variant";
    EVideoTypes["mp3"] = "mp3";
    EVideoTypes["oga"] = "oga";
    EVideoTypes["m4a"] = "m4a";
    EVideoTypes["aac"] = "aac";
    EVideoTypes["hls"] = "hls.variant.audio";
})(EVideoTypes = exports.EVideoTypes || (exports.EVideoTypes = {}));
var EUrlscreenshotAgent;
(function (EUrlscreenshotAgent) {
    EUrlscreenshotAgent["desktop"] = "desktop";
    EUrlscreenshotAgent["mobile"] = "mobile";
})(EUrlscreenshotAgent = exports.EUrlscreenshotAgent || (exports.EUrlscreenshotAgent = {}));
var EUrlscreenshotMode;
(function (EUrlscreenshotMode) {
    EUrlscreenshotMode["all"] = "all";
    EUrlscreenshotMode["window"] = "window";
})(EUrlscreenshotMode = exports.EUrlscreenshotMode || (exports.EUrlscreenshotMode = {}));
var EUrlscreenshotOrientation;
(function (EUrlscreenshotOrientation) {
    EUrlscreenshotOrientation["portrait"] = "portrait";
    EUrlscreenshotOrientation["landscape"] = "landscape";
})(EUrlscreenshotOrientation = exports.EUrlscreenshotOrientation || (exports.EUrlscreenshotOrientation = {}));
/**
 * Video storage location
 */
var EVideoLocations;
(function (EVideoLocations) {
    EVideoLocations["s3"] = "s3";
    EVideoLocations["azure"] = "azure";
    EVideoLocations["gcs"] = "gcs";
    EVideoLocations["rackspace"] = "rackspace";
    EVideoLocations["dropbox"] = "dropbox";
})(EVideoLocations = exports.EVideoLocations || (exports.EVideoLocations = {}));
var EVideoAccess;
(function (EVideoAccess) {
    EVideoAccess["private"] = "private";
    EVideoAccess["public"] = "public";
})(EVideoAccess = exports.EVideoAccess || (exports.EVideoAccess = {}));
var EVideoAccessMode;
(function (EVideoAccessMode) {
    EVideoAccessMode["preserve"] = "preserve";
    EVideoAccessMode["constrain"] = "constrain";
    EVideoAccessMode["letterbox"] = "letterbox";
    EVideoAccessMode["pad"] = "pad";
    EVideoAccessMode["crop"] = "crop";
})(EVideoAccessMode = exports.EVideoAccessMode || (exports.EVideoAccessMode = {}));
/**
 * Creates filestack transform url.
 * Transform params can be provided in camelCase or snakeCase style
 *
 * @example
 * ```js
 * // camelCase
 * console.log(transform(session, {
 *    partialPixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * ```js
 * // snake_case
 * console.log(transform(session, {
 *    partial_pixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * Client.transform is deprecated. Use Filelink class instead
 *
 * @private
 * @throws Error
 * @param options Transformation options
 * @param url url, handle or array of elements
 */
exports.transform = function (session, url, options, b64) {
    if (options === void 0) { options = {}; }
    if (b64 === void 0) { b64 = false; }
    options = toSnakeCase(options);
    if (session.policy && session.signature) {
        options.security = {
            policy: session.policy,
            signature: session.signature,
        };
    }
    var filelink = new filelink_1.Filelink(url, session.apikey);
    filelink.setCname(session.cname);
    filelink.setBase64(b64);
    Object.keys(options).forEach(function (key) {
        if (typeof options[key] === 'boolean' && !options[key] && key !== 'cache') {
            return;
        }
        filelink.addTask(key, options[key]);
    });
    return filelink.toString();
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3RyYW5zZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOztBQUdILDBDQUF5QztBQUV6Qzs7R0FFRztBQUNILElBQU0sV0FBVyxHQUFHLFVBQUMsUUFBa0M7SUFDckQsSUFBSSxVQUFVLEdBQTZCLEVBQUUsQ0FBQztJQUU5QyxJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRW5DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3BDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRWhFLElBQUksT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM5RSxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3JEO2FBQU07WUFDTCxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3hDO0tBQ0Y7SUFFRCxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDLENBQUM7QUFFRjs7R0FFRztBQUNILElBQVksYUFNWDtBQU5ELFdBQVksYUFBYTtJQUN2Qiw4QkFBYSxDQUFBO0lBQ2IsZ0NBQWUsQ0FBQTtJQUNmLGtDQUFpQixDQUFBO0lBQ2pCLGtDQUFpQixDQUFB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RUQsSUFBTSxRQUFRLEdBQUcsSUFBSSxtQkFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkQsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV4QixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEdBQTJCO1FBQ3ZELElBQUksT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsS0FBSyxPQUFPLEVBQUU7WUFDekUsT0FBTztTQUNSO1FBRUQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUM3QixDQUFDLENBQUMiLCJmaWxlIjoibGliL2FwaS90cmFuc2Zvcm0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDE4IGJ5IEZpbGVzdGFjay5cbiAqIFNvbWUgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnLi4vY2xpZW50JztcbmltcG9ydCB7IEZpbGVsaW5rIH0gZnJvbSAnLi8uLi9maWxlbGluayc7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgdG9TbmFrZUNhc2UgPSAob3JpZ2luYWw6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSk6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gIGxldCBzbmFrZUNhc2VkOiB7IFtpbmRleDogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMob3JpZ2luYWwpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGxldCBuZXdLZXkgPSBrZXlzW2ldLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCdfJykudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmICh0eXBlb2Ygb3JpZ2luYWxba2V5c1tpXV0gPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KG9yaWdpbmFsW2tleXNbaV1dKSkge1xuICAgICAgc25ha2VDYXNlZFtuZXdLZXldID0gdG9TbmFrZUNhc2Uob3JpZ2luYWxba2V5c1tpXV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzbmFrZUNhc2VkW25ld0tleV0gPSBvcmlnaW5hbFtrZXlzW2ldXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc25ha2VDYXNlZDtcbn07XG5cbi8qKlxuICogQWxpZ24gZW51bVxuICovXG5leHBvcnQgZW51bSBFQWxpZ25PcHRpb25zIHtcbiAgbGVmdCA9ICdsZWZ0JyxcbiAgcmlnaHQgPSAncmlnaHQnLFxuICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgYm90dG9tID0gJ2JvdHRvbScsXG4gIHRvcCA9ICd0b3AnLFxufVxuXG4vKipcbiAqIEFsaWduIGVudW0gd2l0aCBmYWNlcyBvcHRpb25cbiAqL1xuZXhwb3J0IGVudW0gRUFsaWduRmFjZXNPcHRpb25zIHtcbiAgbGVmdCA9ICdsZWZ0JyxcbiAgcmlnaHQgPSAncmlnaHQnLFxuICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgYm90dG9tID0gJ2JvdHRvbScsXG4gIHRvcCA9ICd0b3AnLFxuICBmYWNlcyA9ICdmYWNlcycsXG59XG5cbi8qKlxuICogRml0IGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUZpdE9wdGlvbnMge1xuICBjbGlwID0gJ2NsaXAnLFxuICBjcm9wID0gJ2Nyb3AnLFxuICBzY2FsZSA9ICdzY2FsZScsXG4gIG1heCA9ICdtYXgnLFxufVxuXG4vKipcbiAqIEJsdXIgZW51bVxuICovXG5leHBvcnQgZW51bSBFQmx1ck1vZGUge1xuICBsaW5lYXIgPSAnbGluZWFyJyxcbiAgZ2F1c3NpYW4gPSAnZ2F1c3NpYW4nLFxufVxuXG4vKipcbiAqIFNoYXBlcyBlbnVtXG4gKi9cbmV4cG9ydCBlbnVtIEVTaGFwZVR5cGUge1xuICBvdmFsID0gJ292YWwnLFxuICByZWN0ID0gJ3JlY3QnLFxufVxuXG4vKipcbiAqIE5vaXNlIHR5cGUgZW51bVxuICovXG5leHBvcnQgZW51bSBFTm9pc2VUeXBlIHtcbiAgbm9uZSA9ICdub25lJyxcbiAgbG93ID0gJ2xvdycsXG4gIG1lZGl1bSA9ICdtZWRpdW0nLFxuICBoaWdoID0gJ2hpZ2gnLFxufVxuXG4vKipcbiAqIFN0eWxlIHR5cGUgZW51bVxuICovXG5leHBvcnQgZW51bSBFU3R5bGVUeXBlIHtcbiAgYXJ0d29yayA9ICdhcnR3b3JrJyxcbiAgcGhvdG8gPSAncGhvdG8nLFxufVxuXG4vKipcbiAqIENvbG9yIHNwYWNlIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUNvbG9yc3BhY2VUeXBlIHtcbiAgUkdCID0gJ1JHQicsXG4gIENNWUsgPSAnQ01ZSycsXG4gIElucHV0ID0gJ0lucHV0Jyxcbn1cblxuLyoqXG4gKiBDcm9wIGZhY2VzIG9wdGlvbnMgZW51bVxuICovXG5leHBvcnQgZW51bSBFQ3JvcGZhY2VzVHlwZSB7XG4gIHRodW1iID0gJ3RodW1iJyxcbiAgY3JvcCA9ICdjcm9wJyxcbiAgZmlsbCA9ICdmaWxsJyxcbn1cblxuLyoqXG4gKiBDb252ZXJ0IHRvIGZvcm1hdFxuICovXG5leHBvcnQgZW51bSBFVmlkZW9UeXBlcyB7XG4gICAgaDI2NCA9ICdoMjY0JyxcbiAgICBoMjY0X2hpID0gJ2gyNjQuaGknLFxuICAgIHdlYm0gPSAnd2VibScsXG4gICAgJ3dlYm0taGknID0gJ3dlYm0uaGknLFxuICAgIG9nZyA9ICdvZ2cnLFxuICAgICdvZ2ctaGknID0gJ29nZy5oaScsXG4gICAgJ2hscy12YXJpYW50JyA9ICdobHMudmFyaWFudCcsXG4gICAgbXAzID0gJ21wMycsXG4gICAgb2dhID0gJ29nYScsXG4gICAgbTRhID0gJ200YScsXG4gICAgYWFjID0gJ2FhYycsXG4gICAgaGxzID0gJ2hscy52YXJpYW50LmF1ZGlvJyxcbn1cblxuZXhwb3J0IGVudW0gRVVybHNjcmVlbnNob3RBZ2VudCB7XG4gIGRlc2t0b3AgPSAnZGVza3RvcCcsXG4gIG1vYmlsZSA9ICdtb2JpbGUnLFxufVxuXG5leHBvcnQgZW51bSBFVXJsc2NyZWVuc2hvdE1vZGUge1xuICBhbGwgPSAnYWxsJyxcbiAgd2luZG93ID0gJ3dpbmRvdycsXG59XG5cbmV4cG9ydCBlbnVtIEVVcmxzY3JlZW5zaG90T3JpZW50YXRpb24ge1xuICBwb3J0cmFpdCA9ICdwb3J0cmFpdCcsXG4gIGxhbmRzY2FwZSA9ICdsYW5kc2NhcGUnLFxufVxuXG4vKipcbiAqIFZpZGVvIHN0b3JhZ2UgbG9jYXRpb25cbiAqL1xuZXhwb3J0IGVudW0gRVZpZGVvTG9jYXRpb25zIHtcbiAgczMgPSAnczMnLFxuICBhenVyZSA9ICdhenVyZScsXG4gIGdjcyA9ICdnY3MnLFxuICByYWNrc3BhY2UgPSAncmFja3NwYWNlJyxcbiAgZHJvcGJveCA9ICdkcm9wYm94Jyxcbn1cblxuZXhwb3J0IGVudW0gRVZpZGVvQWNjZXNzIHtcbiAgcHJpdmF0ZSA9ICdwcml2YXRlJyxcbiAgcHVibGljID0gJ3B1YmxpYycsXG59XG5cbmV4cG9ydCBlbnVtIEVWaWRlb0FjY2Vzc01vZGUge1xuICBwcmVzZXJ2ZSA9ICdwcmVzZXJ2ZScsXG4gIGNvbnN0cmFpbiA9ICdjb25zdHJhaW4nLFxuICBsZXR0ZXJib3ggPSAnbGV0dGVyYm94JyxcbiAgcGFkID0gJ3BhZCcsXG4gIGNyb3AgPSAnY3JvcCcsXG59XG5cbi8qKlxuICogQHNlZSBodHRwczovL3d3dy5maWxlc3RhY2suY29tL2RvY3MvaW1hZ2UtdHJhbnNmb3JtYXRpb25zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNmb3JtT3B0aW9ucyB7XG4gIGZsaXA/OiBib29sZWFuO1xuICBjb21wcmVzcz86IGJvb2xlYW47XG4gIGZsb3A/OiBib29sZWFuO1xuICBlbmNoYW5jZT86IGJvb2xlYW47XG4gIHJlZGV5ZT86IGJvb2xlYW47XG4gIG1vbm9jaHJvbWU/OiBib29sZWFuO1xuICBuZWdhdGl2ZT86IGJvb2xlYW47XG4gIHRhZ3M/OiBib29sZWFuO1xuICBzZnc/OiBib29sZWFuO1xuICBzdG9yZT86IHtcbiAgICBmaWxlbmFtZT86IHN0cmluZyxcbiAgICBsb2NhdGlvbj86IHN0cmluZyxcbiAgICBwYXRoPzogc3RyaW5nLFxuICAgIGNvbnRhaW5lcj86IHN0cmluZyxcbiAgICByZWdpb24/OiBzdHJpbmc7XG4gICAgYWNjZXNzPzogc3RyaW5nO1xuICAgIGJhc2U2NGRlY29kZT86IGJvb2xlYW47XG4gIH07XG4gIHJlc2l6ZT86IHtcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgZml0PzogRUZpdE9wdGlvbnM7XG4gICAgYWxpZ24/OiBFQWxpZ25GYWNlc09wdGlvbnM7XG4gIH07XG4gIGNyb3A/OiB7XG4gICAgZGltOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXVxuICB9O1xuICByb3RhdGU/OiB7XG4gICAgZGVnOiBudW1iZXIgfCBzdHJpbmc7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfTtcbiAgZGV0ZWN0X2ZhY2VzPzoge1xuICAgIG1pbnNpemU/OiBudW1iZXI7XG4gICAgbWF4c2l6ZT86IG51bWJlcjtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICBleHBvcnQ/OiBib29sZWFuO1xuICB9IHwgdHJ1ZTtcbiAgY3JvcF9mYWNlcz86IHtcbiAgICBtb2RlPzogRUNyb3BmYWNlc1R5cGU7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIGZhY2VzPzogbnVtYmVyIHwgc3RyaW5nO1xuICAgIGJ1ZmZlcj86IG51bWJlcjtcbiAgfTtcbiAgcGl4ZWxhdGVfZmFjZXM/OiB7XG4gICAgZmFjZXM/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgbWluc2l6ZT86IG51bWJlcjtcbiAgICBtYXhzaXplPzogbnVtYmVyO1xuICAgIGJ1ZmZlcj86IG51bWJlcjtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cj86IG51bWJlcjtcbiAgICB0eXBlPzogRVNoYXBlVHlwZTtcbiAgfTtcbiAgYmx1cl9mYWNlcz86IHtcbiAgICBmYWNlcz86IG51bWJlciB8IHN0cmluZztcbiAgICBtaW5zaXplPzogbnVtYmVyO1xuICAgIG1heHNpemU/OiBudW1iZXI7XG4gICAgYnVmZmVyPzogbnVtYmVyO1xuICAgIGFtb3VudD86IG51bWJlcjtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIHR5cGU/OiBFU2hhcGVUeXBlO1xuICB9O1xuICByb3VuZGVkX2Nvcm5lcnM/OiB7XG4gICAgcmFkaXVzPzogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHZpZ25ldHRlPzoge1xuICAgIGFtb3VudD86IG51bWJlcjtcbiAgICBibHVybW9kZT86IEVCbHVyTW9kZTtcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICB9O1xuICBwb2xhcm9pZD86IHtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICByb3RhdGU/OiBudW1iZXI7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHRvcm5fZWRnZXM/OiB7XG4gICAgc3ByZWFkPzogW251bWJlciwgbnVtYmVyXTtcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICB9IHwgdHJ1ZTtcbiAgc2hhZG93Pzoge1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgb3BhY2l0eT86IG51bWJlcjtcbiAgICB2ZWN0b3I/OiBbbnVtYmVyLCBudW1iZXJdO1xuICAgIGNvbG9yPzogc3RyaW5nO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICBjaXJjbGU/OiB7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIGJvcmRlcj86IHtcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICB9IHwgdHJ1ZTtcbiAgc2hhcnBlbj86IHtcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIGJsdXI/OiB7XG4gICAgYW1vdW50OiBudW1iZXI7XG4gIH0gfCB0cnVlO1xuICBibGFja3doaXRlPzoge1xuICAgIHRocmVzaG9sZDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgc2VwaWE/OiB7XG4gICAgdG9uZTogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgcGl4ZWxhdGU/OiB7XG4gICAgYW1vdW50OiBudW1iZXI7XG4gIH0gfCB0cnVlO1xuICBvaWxfcGFpbnQ/OiB7XG4gICAgYW1vdW50OiBudW1iZXI7XG4gIH0gfCB0cnVlO1xuICBtb2R1bGF0ZT86IHtcbiAgICBicmlnaHRuZXNzPzogbnVtYmVyO1xuICAgIGh1ZT86IG51bWJlcjtcbiAgICBzYXR1cmF0aW9uPzogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgcGFydGlhbF9waXhlbGF0ZT86IHtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cj86IG51bWJlcjtcbiAgICB0eXBlPzogRVNoYXBlVHlwZTtcbiAgICBvYmplY3RzPzogW1tudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdXTtcbiAgfTtcbiAgcGFydGlhbF9ibHVyPzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgdHlwZT86IEVTaGFwZVR5cGU7XG4gICAgb2JqZWN0cz86IFtbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXV07XG4gIH07XG4gIGNvbGxhZ2U/OiB7XG4gICAgbWFyZ2luPzogbnVtYmVyO1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICBmaXQ/OiBFRml0T3B0aW9ucyxcbiAgICBmaWxlczogW3N0cmluZ107XG4gIH07XG4gIHVwc2NhbGU/OiB7XG4gICAgdXBzY2FsZT86IGJvb2xlYW47XG4gICAgbm9pc2U/OiBFTm9pc2VUeXBlO1xuICAgIHN0eWxlPzogRVN0eWxlVHlwZTtcbiAgfSB8IHRydWU7XG4gIGFzY2lpPzoge1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gICAgZm9yZWdyb3VuZD86IHN0cmluZztcbiAgICBjb2xvcmVkPzogYm9vbGVhbjtcbiAgICBzaXplPzogbnVtYmVyO1xuICAgIHJldmVyc2U/OiBib29sZWFuO1xuICB9IHwgdHJ1ZTtcbiAgcXVhbGl0eT86IHtcbiAgICB2YWx1ZTogbnVtYmVyO1xuICB9O1xuICBzZWN1cml0eT86IHtcbiAgICBwb2xpY3k6IHN0cmluZztcbiAgICBzaWduYXR1cmU/OiBzdHJpbmc7XG4gIH07XG4gIG91dHB1dD86IHtcbiAgICBmb3JtYXQ6IHN0cmluZztcbiAgICBjb2xvcnNwYWNlPzogc3RyaW5nO1xuICAgIHN0cmlwPzogYm9vbGVhbjtcbiAgICBxdWFsaXR5PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgY29tcHJlc3M/OiBib29sZWFuO1xuICAgIGRlbnNpdHk/OiBudW1iZXI7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgICBzZWN1cmU/OiBib29sZWFuO1xuICAgIGRvY2luZm8/OiBib29sZWFuO1xuICAgIHBhZ2Vmb3JtYXQ/OiBzdHJpbmc7XG4gICAgcGFnZW9yaWVudGF0aW9uPzogc3RyaW5nO1xuICB9O1xuICBjYWNoZT86IHtcbiAgICBjYWNoZT86IGJvb2xlYW47XG4gICAgZXhwaXJ5OiBudW1iZXI7XG4gIH07XG4gIC8vIGF1ZGlvL3ZpZGVvXG4gIHZpZGVvX2NvbnZlcnQ/OiB7XG4gICAgYXNwZWN0X21vZGU6IEVWaWRlb0FjY2Vzc01vZGU7XG4gICAgcHJlc2V0PzogRVZpZGVvVHlwZXM7XG4gICAgZm9yY2U/OiBib29sZWFuO1xuICAgIHRpdGxlPzogc3RyaW5nO1xuICAgIGV4dG5hbWU/OiBzdHJpbmc7XG4gICAgZmlsZW5hbWU/OiBzdHJpbmc7XG4gICAgbG9jYXRpb24/OiBFVmlkZW9Mb2NhdGlvbnM7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICBhY2Nlc3M/OiBFVmlkZW9BY2Nlc3M7XG4gICAgY29udGFpbmVyPzogc3RyaW5nO1xuICAgIGF1ZGlvX2JpdHJhdGU/OiBudW1iZXI7XG4gICAgdXBzY2FsZTogYm9vbGVhbjtcbiAgICB2aWRlb19iaXRyYXRlPzogbnVtYmVyO1xuICAgIGF1ZGlvX3NhbXBsZV9yYXRlPzogbnVtYmVyO1xuICAgIGF1ZGlvX2NoYW5uZWxzPzogbnVtYmVyO1xuICAgIGNsaXBfbGVuZ3RoPzogc3RyaW5nO1xuICAgIGNsaXBfb2Zmc2V0Pzogc3RyaW5nO1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICB0d29fcGFzcz86IGJvb2xlYW47XG4gICAgZnBzPzogbnVtYmVyO1xuICAgIGtleWZyYW1lX2ludGVydmFsPzogbnVtYmVyO1xuICAgIHdhdGVybWFya191cmw/OiBzdHJpbmc7XG4gICAgd2F0ZXJtYXJrX3RvcD86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfYm90dG9tPzogbnVtYmVyO1xuICAgIHdhdGVybWFya19yaWdodD86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfbGVmdD86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfd2lkdGg/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX2hlaWdodD86IG51bWJlcjtcbiAgfTtcbiAgdXJsc2NyZWVuc2hvdD86IHtcbiAgICBhZ2VudD86IEVVcmxzY3JlZW5zaG90QWdlbnQ7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIG1vZGU/OiBFVXJsc2NyZWVuc2hvdE1vZGU7XG4gICAgZGVsYXk/OiBudW1iZXI7XG4gICAgb3JpZW50YXRpb24/OiBFVXJsc2NyZWVuc2hvdE9yaWVudGF0aW9uO1xuICAgIGRldmljZT86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHBkZmluZm8/OiB7XG4gICAgY29sb3JpbmZvPzogYm9vbGVhblxuICB9IHwgdHJ1ZTtcbiAgcGRmY29udmVydD86IHtcbiAgICBwYWdlb3JpZW50YXRpb24/OiBzdHJpbmdcbiAgICBwYWdlZm9ybWF0Pzogc3RyaW5nXG4gICAgcGFnZXM/OiAoc3RyaW5nIHwgbnVtYmVyKVtdXG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlcyBmaWxlc3RhY2sgdHJhbnNmb3JtIHVybC5cbiAqIFRyYW5zZm9ybSBwYXJhbXMgY2FuIGJlIHByb3ZpZGVkIGluIGNhbWVsQ2FzZSBvciBzbmFrZUNhc2Ugc3R5bGVcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBganNcbiAqIC8vIGNhbWVsQ2FzZVxuICogY29uc29sZS5sb2codHJhbnNmb3JtKHNlc3Npb24sIHtcbiAqICAgIHBhcnRpYWxQaXhlbGF0ZToge1xuICogICAgICBvYmplY3RzOiBbWzEwLCAyMCwgMjAwLCAyNTBdLCBbMjc1LCA5MSwgNTAwLCA1NTddXSxcbiAqICAgIH0sXG4gKiAgfSwgJ3Rlc3RmaWxlJykpO1xuICogYGBgXG4gKiByZXN1bHQgPT4gaHR0cHM6Ly9jZG4uZmlsZXN0YWNrY29udGVudC5jb20vcGFydGlhbF9waXhlbGF0ZT1vYmplY3RzOltbMTAsMjAsMjAwLDI1MF0sWzI3NSw5MSw1MDAsNTU3XV0vdGVzdGZpbGVcbiAqXG4gKiBgYGBqc1xuICogLy8gc25ha2VfY2FzZVxuICogY29uc29sZS5sb2codHJhbnNmb3JtKHNlc3Npb24sIHtcbiAqICAgIHBhcnRpYWxfcGl4ZWxhdGU6IHtcbiAqICAgICAgb2JqZWN0czogW1sxMCwgMjAsIDIwMCwgMjUwXSwgWzI3NSwgOTEsIDUwMCwgNTU3XV0sXG4gKiAgICB9LFxuICogIH0sICd0ZXN0ZmlsZScpKTtcbiAqIGBgYFxuICogcmVzdWx0ID0+IGh0dHBzOi8vY2RuLmZpbGVzdGFja2NvbnRlbnQuY29tL3BhcnRpYWxfcGl4ZWxhdGU9b2JqZWN0czpbWzEwLDIwLDIwMCwyNTBdLFsyNzUsOTEsNTAwLDU1N11dL3Rlc3RmaWxlXG4gKlxuICogQ2xpZW50LnRyYW5zZm9ybSBpcyBkZXByZWNhdGVkLiBVc2UgRmlsZWxpbmsgY2xhc3MgaW5zdGVhZFxuICpcbiAqIEBwcml2YXRlXG4gKiBAdGhyb3dzIEVycm9yXG4gKiBAcGFyYW0gb3B0aW9ucyBUcmFuc2Zvcm1hdGlvbiBvcHRpb25zXG4gKiBAcGFyYW0gdXJsIHVybCwgaGFuZGxlIG9yIGFycmF5IG9mIGVsZW1lbnRzXG4gKi9cbmV4cG9ydCBjb25zdCB0cmFuc2Zvcm0gPSAoc2Vzc2lvbjogU2Vzc2lvbiwgdXJsOiBzdHJpbmcgfCBzdHJpbmdbXSwgb3B0aW9uczogVHJhbnNmb3JtT3B0aW9ucyA9IHt9LCBiNjQ6IGJvb2xlYW4gPSBmYWxzZSk6IHN0cmluZyA9PiB7XG4gIG9wdGlvbnMgPSB0b1NuYWtlQ2FzZShvcHRpb25zKTtcblxuICBpZiAoc2Vzc2lvbi5wb2xpY3kgJiYgc2Vzc2lvbi5zaWduYXR1cmUpIHtcbiAgICBvcHRpb25zLnNlY3VyaXR5ID0ge1xuICAgICAgcG9saWN5OiBzZXNzaW9uLnBvbGljeSxcbiAgICAgIHNpZ25hdHVyZTogc2Vzc2lvbi5zaWduYXR1cmUsXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IGZpbGVsaW5rID0gbmV3IEZpbGVsaW5rKHVybCwgc2Vzc2lvbi5hcGlrZXkpO1xuICBmaWxlbGluay5zZXRDbmFtZShzZXNzaW9uLmNuYW1lKTtcbiAgZmlsZWxpbmsuc2V0QmFzZTY0KGI2NCk7XG5cbiAgT2JqZWN0LmtleXMob3B0aW9ucykuZm9yRWFjaCgoa2V5OiBrZXlvZiBUcmFuc2Zvcm1PcHRpb25zKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zW2tleV0gPT09ICdib29sZWFuJyAmJiAhb3B0aW9uc1trZXldICYmIGtleSAhPT0gJ2NhY2hlJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZpbGVsaW5rLmFkZFRhc2soa2V5LCBvcHRpb25zW2tleV0pO1xuICB9KTtcblxuICByZXR1cm4gZmlsZWxpbmsudG9TdHJpbmcoKTtcbn07XG4iXX0=
