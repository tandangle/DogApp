"use strict";
/*
 * Copyright (c) 2018 by Filestack
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
/* istanbul ignore file */
var nock = require("nock");
var zlib = require("zlib");
var types_1 = require("../types");
var token_1 = require("../token");
var error_1 = require("../error");
exports.adaptersHttpAbstract = function (adapter, adapterName) {
    describe("Request/Adapters/" + adapterName, function () {
        var scope;
        var url = 'https://somewrongdom.moc';
        beforeEach(function () {
            nock.cleanAll();
            scope = null;
        });
        beforeEach(function () {
            scope = nock(url).defaultReplyHeaders({
                'access-control-allow-origin': function (req) { return req.headers['origin']; },
                'access-control-allow-methods': function (req) { return req.headers['access-control-request-method']; },
                'access-control-allow-headers': function (req) { return req.headers['access-control-request-headers']; },
            });
            if (adapterName === 'xhr') {
                scope.options(/.*/).reply(200);
            }
        });
        describe('request basic', function () {
            it('should make correct request (https)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').reply(200, 'ok', { 'Content-Type': 'text/plain' });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(res.data).toEqual('ok');
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request (http)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var httpUrl, scopeHttp, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            httpUrl = url.replace('https', 'http');
                            scopeHttp = nock(httpUrl).defaultReplyHeaders({
                                'access-control-allow-origin': function (req) { return req.headers['origin']; },
                                'access-control-allow-methods': function (req) { return req.headers['access-control-request-method']; },
                                'access-control-allow-headers': function (req) { return req.headers['access-control-request-headers']; },
                            });
                            if (adapterName === 'xhr') {
                                scopeHttp.options(/.*/).reply(200);
                            }
                            options = {
                                url: httpUrl,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scopeHttp.get('/').reply(200, 'ok', { 'Content-Type': 'text/plain' });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(res.data).toEqual('ok');
                            scopeHttp.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should add https protocol if no protocol is provided', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url.replace('https://', ''),
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').reply(200, 'ok', { 'Content-Type': 'text/plain' });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(res.data).toEqual('ok');
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should handle string as data param', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var msg, mock, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            msg = 'Some test stream data';
                            mock = jest
                                .fn()
                                .mockName('bufferData')
                                .mockReturnValue(msg);
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.POST,
                                data: msg,
                            };
                            scope.post('/').reply(200, function (_, data) {
                                return mock(data);
                            }, { 'Content-Type': 'text/plain' });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(res.data).toEqual(msg);
                            expect(mock).toHaveBeenLastCalledWith(msg);
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            // gzip support is handled by the browser on xhr side
            if (adapterName !== 'xhr') {
                it('should handle deflate response', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, data, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                data = zlib.gzipSync(Buffer.from('ok', 'utf-8'));
                                scope.get('/').reply(200, data, { 'Content-encoding': 'gzip, deflate', 'Content-type': 'text/plain' });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                expect(res.status).toEqual(200);
                                expect(res.data).toEqual('ok');
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should handle 204 gzip request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                scope.get('/').reply(204, '', { 'Content-encoding': 'gzip, deflate', 'Content-type': 'text/plain' });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                expect(res.status).toEqual(204);
                                expect(res.data).toEqual(null);
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should handle Buffer as data param', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var msg, mock, options, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                msg = 'Some test stream data';
                                mock = jest
                                    .fn()
                                    .mockName('bufferData')
                                    .mockReturnValue('ok');
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.POST,
                                    data: Buffer.from(msg, 'utf-8'),
                                };
                                scope.post('/').reply(200, function (_, data) {
                                    return mock(data);
                                }, { 'Content-type': 'text/plain' });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                expect(res.status).toEqual(200);
                                expect(mock).toHaveBeenLastCalledWith(msg);
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should throw error when data type is unsupported', function () {
                    var Readable = require('stream').Readable;
                    var options = {
                        url: url,
                        method: types_1.FsHttpMethod.POST,
                        data: Readable.from(['test']),
                    };
                    var requestAdapter = new adapter();
                    return expect(requestAdapter.request(options)).rejects.toEqual(expect.any(error_1.FsRequestError));
                });
            }
            it('should make request with auth', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var auth, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            auth = {
                                username: 'test',
                                password: 'test',
                            };
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                auth: auth,
                            };
                            scope.options('/').reply(200, 'ok');
                            scope
                                .get('/')
                                .basicAuth({ user: auth.username, pass: auth.password })
                                .reply(200, 'ok', { 'access-control-allow-origin': '*' });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw an error on empty username', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var auth, options, requestAdapter;
                return tslib_1.__generator(this, function (_a) {
                    auth = {
                        username: null,
                        password: 'test',
                    };
                    options = {
                        url: url,
                        method: types_1.FsHttpMethod.GET,
                        auth: auth,
                    };
                    requestAdapter = new adapter();
                    return [2 /*return*/, expect(requestAdapter.request(options)).rejects.toEqual(expect.any(error_1.FsRequestError))];
                });
            }); });
            it('should throw an error on empty password', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var auth, options, requestAdapter;
                return tslib_1.__generator(this, function (_a) {
                    auth = {
                        username: 'test',
                        password: null,
                    };
                    options = {
                        url: url,
                        method: types_1.FsHttpMethod.GET,
                        auth: auth,
                    };
                    requestAdapter = new adapter();
                    return [2 /*return*/, expect(requestAdapter.request(options)).rejects.toEqual(expect.any(error_1.FsRequestError))];
                });
            }); });
            it('should overwrite auth header if auth data is provided', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var auth, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            auth = {
                                username: 'test',
                                password: 'test',
                            };
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                auth: auth,
                                headers: {
                                    Authorization: 'test123',
                                },
                            };
                            scope.options('/').reply(200, 'ok');
                            scope
                                .get('/')
                                .basicAuth({ user: auth.username, pass: auth.password })
                                .reply(200, 'ok');
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should contain default headers', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var mock, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mock = jest
                                .fn()
                                .mockName('default/headers')
                                .mockReturnValue('ok');
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').reply(200, function (_, data) {
                                return mock(this.req.headers);
                            });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(mock).toHaveBeenCalledWith(expect.objectContaining({ 'filestack-source': expect.any(String), 'filestack-trace-id': expect.any(String), 'filestack-trace-span': expect.any(String) }));
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should omit default headers', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var mock, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mock = jest
                                .fn()
                                .mockName('default/headers')
                                .mockReturnValue('ok');
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                filestackHeaders: false,
                            };
                            scope.get('/').reply(200, function (_, data) {
                                return mock(this.req.headers);
                            });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(mock).toHaveBeenCalledWith(expect.not.objectContaining({ 'filestack-source': expect.any(String), 'filestack-trace-id': expect.any(String), 'filestack-trace-span': expect.any(String) }));
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should skip undefined headers', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var mock, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mock = jest
                                .fn()
                                .mockName('undefined/headers')
                                .mockReturnValue('ok');
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                headers: {
                                    test: undefined,
                                },
                            };
                            scope.get('/').reply(200, function (_, data) {
                                return mock(this.req.headers);
                            });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            expect(res.status).toEqual(200);
                            expect(mock).toHaveBeenCalledWith(expect.not.objectContaining({ test: undefined }));
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
        describe('redirects ', function () {
            // xhr redirects are handled by the browser
            if (adapterName !== 'xhr') {
                it('should follow 302 redirect', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, response, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                response = { test: 123 };
                                scope.get('/').reply(302, 'ok', {
                                    location: url + "/resp",
                                });
                                scope.get('/resp').reply(200, response, {
                                    'Content-type': 'application/json',
                                });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                expect(res.status).toEqual(200);
                                expect(res.data).toEqual(response);
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should throw error when no location is provided', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, requestAdapter, err_1;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                scope.get('/').reply(302, 'ok', { location: '' });
                                _a.label = 1;
                            case 1:
                                _a.trys.push([1, 3, , 4]);
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 2:
                                _a.sent();
                                // return error in try will not emit error
                                expect(false).toEqual(true);
                                return [3 /*break*/, 4];
                            case 3:
                                err_1 = _a.sent();
                                expect(err_1).toEqual(expect.any(error_1.FsRequestError));
                                expect(err_1.code).toEqual(error_1.FsRequestErrorCode.REDIRECT);
                                return [3 /*break*/, 4];
                            case 4:
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should throw error (REDIRECT) on max redirects', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, requestAdapter, err_2;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                if (adapterName === 'xhr') {
                                    scope.options('/').reply(200, 'ok');
                                }
                                scope
                                    .get('/')
                                    .reply(302, 'ok', {
                                    location: url + "/a",
                                })
                                    .get('/a')
                                    .reply(301, 'ok', {
                                    location: url + "/b",
                                })
                                    .get('/b')
                                    .reply(302, 'ok', {
                                    location: url + "/c",
                                })
                                    .get('/c')
                                    .reply(301, 'ok', {
                                    location: url + "/d",
                                })
                                    .get('/d')
                                    .reply(302, 'ok', {
                                    location: url + "/e",
                                })
                                    .get('/e')
                                    .reply(301, 'ok', {
                                    location: url + "/f",
                                })
                                    .get('/f')
                                    .reply(302, 'ok', {
                                    location: url + "/g",
                                })
                                    .get('/g')
                                    .reply(301, 'ok', {
                                    location: url + "/h",
                                })
                                    .get('/h')
                                    .reply(302, 'ok', {
                                    location: url + "/i",
                                })
                                    .get('/i')
                                    .reply(301, 'ok', {
                                    location: url + "/j",
                                })
                                    .get('/j')
                                    .reply(302, 'ok', {
                                    location: url + "/k",
                                });
                                _a.label = 1;
                            case 1:
                                _a.trys.push([1, 3, , 4]);
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 2:
                                _a.sent();
                                // return error in try will not emit error
                                expect(false).toEqual(true);
                                return [3 /*break*/, 4];
                            case 3:
                                err_2 = _a.sent();
                                expect(err_2).toEqual(expect.any(error_1.FsRequestError));
                                expect(err_2.code).toEqual(error_1.FsRequestErrorCode.REDIRECT);
                                return [3 /*break*/, 4];
                            case 4:
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
                it('should throw error on redirect loop', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var options, requestAdapter, err_3;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.GET,
                                };
                                scope
                                    .get('/')
                                    .reply(302, 'ok', { location: url + "/a" })
                                    .get('/a')
                                    .reply(302, 'ok', { location: url + "/a" })
                                    .get('/a')
                                    .reply(200, 'ok');
                                _a.label = 1;
                            case 1:
                                _a.trys.push([1, 3, , 4]);
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 2:
                                _a.sent();
                                // return error in try will not emit error
                                expect(false).toEqual(true);
                                return [3 /*break*/, 4];
                            case 3:
                                err_3 = _a.sent();
                                expect(err_3).toEqual(expect.any(error_1.FsRequestError));
                                expect(err_3.code).toEqual(error_1.FsRequestErrorCode.REDIRECT);
                                return [3 /*break*/, 4];
                            case 4: return [2 /*return*/];
                        }
                    });
                }); });
            }
        });
        if (adapterName === 'xhr') {
            describe('request form', function () {
                it('Should send form data', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var form, options, resp, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                form = new FormData();
                                options = {
                                    url: url,
                                    method: types_1.FsHttpMethod.POST,
                                    data: form,
                                };
                                resp = { form: 'ok' };
                                scope.post('/').reply(200, resp, { 'Content-type': 'application/json' });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                expect(res.status).toEqual(200);
                                expect(res.data).toEqual(resp);
                                scope.done();
                                return [2 /*return*/];
                        }
                    });
                }); });
            });
        }
        describe('4xx and 5xx errors handling', function () {
            it('should handle 4xx response', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, errorResp, requestAdapter, err_4;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            errorResp = { test: 123 };
                            scope.get('/').reply(404, errorResp, {
                                'Content-type': 'application/json',
                            });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_4 = _a.sent();
                            expect(err_4).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_4.code).toEqual(error_1.FsRequestErrorCode.REQUEST);
                            expect(err_4.response.status).toEqual(404);
                            expect(err_4.response.data).toEqual(errorResp);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should handle 5xx response', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, errorResp, requestAdapter, err_5;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            errorResp = { test: 123 };
                            scope.get('/').reply(501, errorResp, {
                                'Content-type': 'application/json',
                            });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_5 = _a.sent();
                            expect(err_5).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_5.code).toEqual(error_1.FsRequestErrorCode.SERVER);
                            expect(err_5.response.status).toEqual(501);
                            expect(err_5.response.data).toEqual(errorResp);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
        if (adapterName === 'xhr') {
            describe('progress event', function () {
                it('should handle upload progress', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                    var progressSpy, buf, options, requestAdapter, res;
                    return tslib_1.__generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                progressSpy = jest
                                    .fn()
                                    .mockName('bufferData')
                                    .mockReturnThis();
                                buf = Buffer.alloc(1024);
                                buf.fill('a');
                                options = {
                                    url: url + "/progress",
                                    method: types_1.FsHttpMethod.POST,
                                    onProgress: progressSpy,
                                    data: buf,
                                };
                                scope.options('/progress').reply(200, 'ok', {
                                    'Content-type': 'application/json',
                                });
                                scope.post('/progress').reply(200, 'ok', {
                                    'Content-type': 'application/json',
                                });
                                requestAdapter = new adapter();
                                return [4 /*yield*/, requestAdapter.request(options)];
                            case 1:
                                res = _a.sent();
                                // for jsdom we cannot check progress event correctly
                                expect(progressSpy).toHaveBeenCalled();
                                return [2 /*return*/];
                        }
                    });
                }); });
            });
        }
        describe('cancelToken', function () {
            it('Should throw abort request when token will be called', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var token, options, requestAdapter, err_6;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            token = new token_1.FsCancelToken();
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                cancelToken: token,
                            };
                            scope
                                .get('/')
                                .delay(2000)
                                .reply(200, 'ok', {
                                'Content-type': 'application/json',
                            });
                            setTimeout(function () {
                                token.cancel();
                            }, 100);
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_6 = _a.sent();
                            expect(err_6).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_6.code).toEqual(error_1.FsRequestErrorCode.ABORTED);
                            return [3 /*break*/, 4];
                        case 4: return [2 /*return*/];
                    }
                });
            }); });
            it('Should not throw undefined error when cancel token will be called after request finished', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var token, options, requestAdapter, res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            token = new token_1.FsCancelToken();
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                cancelToken: token,
                            };
                            scope.get('/').reply(200, 'ok', {
                                'Content-type': 'text/plain',
                            });
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 1:
                            res = _a.sent();
                            token.cancel();
                            expect(res.status).toEqual(200);
                            expect(res.data).toEqual('ok');
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
        describe('Network errors', function () {
            it('should throw an error on domain not found', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter;
                return tslib_1.__generator(this, function (_a) {
                    options = {
                        url: 'https://some-badd-url.er',
                        method: types_1.FsHttpMethod.GET,
                    };
                    requestAdapter = new adapter();
                    return [2 /*return*/, expect(requestAdapter.request(options)).rejects.toEqual(expect.any(error_1.FsRequestError))];
                });
            }); });
            it('Should throw an FilestackError on socket abort with FsRequestErrorCode.TIMEOUTED code', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, err_7;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                timeout: 50,
                            };
                            scope
                                .get('/')
                                .delay(2000)
                                .reply(200, 'ok', {
                                'Content-type': 'application/json',
                            });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_7 = _a.sent();
                            expect(err_7).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_7.code).toEqual(error_1.FsRequestErrorCode.TIMEOUT);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('Should throw an FilestackError on response ECONNREFUSED error with FsRequestErrorCode.NETWORK code', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, err_8;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').replyWithError({ code: 'ECONNREFUSED' });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_8 = _a.sent();
                            expect(err_8).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_8.code).toEqual(error_1.FsRequestErrorCode.NETWORK);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('Should throw an FilestackError on response ECONNRESET error with FsRequestErrorCode.NETWORK code', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, err_9;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').replyWithError({ code: 'ECONNRESET' });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_9 = _a.sent();
                            expect(err_9).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_9.code).toEqual(error_1.FsRequestErrorCode.NETWORK);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('Should throw an FilestackError on response ENOTFOUND error with FsRequestErrorCode.NETWORK code', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, err_10;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                            };
                            scope.get('/').replyWithError({ code: 'ENOTFOUND' });
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_10 = _a.sent();
                            expect(err_10).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_10.code).toEqual(error_1.FsRequestErrorCode.NETWORK);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
            it('Should abort request on timeout', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var options, requestAdapter, err_11;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            options = {
                                url: url,
                                method: types_1.FsHttpMethod.GET,
                                timeout: 1000,
                            };
                            scope
                                .get('/')
                                .delay(2000)
                                .reply(200, 'ok');
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            requestAdapter = new adapter();
                            return [4 /*yield*/, requestAdapter.request(options)];
                        case 2:
                            _a.sent();
                            // return error in try will not emit error
                            expect(false).toEqual(true);
                            return [3 /*break*/, 4];
                        case 3:
                            err_11 = _a.sent();
                            expect(err_11).toEqual(expect.any(error_1.FsRequestError));
                            expect(err_11.code).toEqual(error_1.FsRequestErrorCode.TIMEOUT);
                            return [3 /*break*/, 4];
                        case 4:
                            scope.done();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
    });
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvcmVxdWVzdC9hZGFwdGVycy9hZGFwdGVycy5hYnN0cmFjdHNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7O0FBRUgsMEJBQTBCO0FBQzFCLDJCQUE2QjtBQUM3QiwyQkFBNkI7QUFDN0Isa0NBQTBEO0FBQzFELGtDQUF5QztBQUN6QyxrQ0FBOEQ7QUFFakQsUUFBQSxvQkFBb0IsR0FBRyxVQUFDLE9BQVksRUFBRSxXQUFtQjtJQUNwRSxRQUFRLENBQUMsc0JBQW9CLFdBQWEsRUFBRTtRQUMxQyxJQUFJLEtBQUssQ0FBQztRQUNWLElBQU0sR0FBRyxHQUFHLDBCQUEwQixDQUFDO1FBRXZDLFVBQVUsQ0FBQztZQUNULElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNoQixLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7UUFFSCxVQUFVLENBQUM7WUFDVCxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLG1CQUFtQixDQUFDO2dCQUNwQyw2QkFBNkIsRUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQXJCLENBQXFCO2dCQUMzRCw4QkFBOEIsRUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsK0JBQStCLENBQUMsRUFBNUMsQ0FBNEM7Z0JBQ25GLDhCQUE4QixFQUFFLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxFQUE3QyxDQUE2QzthQUNyRixDQUFDLENBQUM7WUFFSCxJQUFJLFdBQVcsS0FBSyxLQUFLLEVBQUU7Z0JBQ3pCLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ2hDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMs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LEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7OztpQkFDZCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9yZXF1ZXN0L2FkYXB0ZXJzL2FkYXB0ZXJzLmFic3RyYWN0c3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTggYnkgRmlsZXN0YWNrXG4gKiBTb21lIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLyogaXN0YW5idWwgaWdub3JlIGZpbGUgKi9cbmltcG9ydCAqIGFzIG5vY2sgZnJvbSAnbm9jayc7XG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuaW1wb3J0IHsgRnNIdHRwTWV0aG9kLCBGc1JlcXVlc3RPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgRnNDYW5jZWxUb2tlbiB9IGZyb20gJy4uL3Rva2VuJztcbmltcG9ydCB7IEZzUmVxdWVzdEVycm9yLCBGc1JlcXVlc3RFcnJvckNvZGUgfSBmcm9tICcuLi9lcnJvcic7XG5cbmV4cG9ydCBjb25zdCBhZGFwdGVyc0h0dHBBYnN0cmFjdCA9IChhZGFwdGVyOiBhbnksIGFkYXB0ZXJOYW1lOiBzdHJpbmcpID0+IHtcbiAgZGVzY3JpYmUoYFJlcXVlc3QvQWRhcHRlcnMvJHthZGFwdGVyTmFtZX1gLCAoKSA9PiB7XG4gICAgbGV0IHNjb3BlO1xuICAgIGNvbnN0IHVybCA9ICdodHRwczovL3NvbWV3cm9uZ2RvbS5tb2MnO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBub2NrLmNsZWFuQWxsKCk7XG4gICAgICBzY29wZSA9IG51bGw7XG4gICAgfSk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHNjb3BlID0gbm9jayh1cmwpLmRlZmF1bHRSZXBseUhlYWRlcnMoe1xuICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJzogcmVxID0+IHJlcS5oZWFkZXJzWydvcmlnaW4nXSxcbiAgICAgICAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHMnOiByZXEgPT4gcmVxLmhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLXJlcXVlc3QtbWV0aG9kJ10sXG4gICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogcmVxID0+IHJlcS5oZWFkZXJzWydhY2Nlc3MtY29udHJvbC1yZXF1ZXN0LWhlYWRlcnMnXSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoYWRhcHRlck5hbWUgPT09ICd4aHInKSB7XG4gICAgICAgIHNjb3BlLm9wdGlvbnMoLy4qLykucmVwbHkoMjAwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdyZXF1ZXN0IGJhc2ljJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCAoaHR0cHMpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgfTtcbiAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoMjAwLCAnb2snLCB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbicgfSk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0VxdWFsKDIwMCk7XG4gICAgICAgIGV4cGVjdChyZXMuZGF0YSkudG9FcXVhbCgnb2snKTtcbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgKGh0dHApJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBodHRwVXJsID0gdXJsLnJlcGxhY2UoJ2h0dHBzJywgJ2h0dHAnKTtcblxuICAgICAgICBjb25zdCBzY29wZUh0dHAgPSBub2NrKGh0dHBVcmwpLmRlZmF1bHRSZXBseUhlYWRlcnMoe1xuICAgICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1vcmlnaW4nOiByZXEgPT4gcmVxLmhlYWRlcnNbJ29yaWdpbiddLFxuICAgICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1tZXRob2RzJzogcmVxID0+IHJlcS5oZWFkZXJzWydhY2Nlc3MtY29udHJvbC1yZXF1ZXN0LW1ldGhvZCddLFxuICAgICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogcmVxID0+IHJlcS5oZWFkZXJzWydhY2Nlc3MtY29udHJvbC1yZXF1ZXN0LWhlYWRlcnMnXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGFkYXB0ZXJOYW1lID09PSAneGhyJykge1xuICAgICAgICAgIHNjb3BlSHR0cC5vcHRpb25zKC8uKi8pLnJlcGx5KDIwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogaHR0cFVybCxcbiAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGVIdHRwLmdldCgnLycpLnJlcGx5KDIwMCwgJ29rJywgeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW4nIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdEFkYXB0ZXIucmVxdWVzdChvcHRpb25zKTtcbiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgICAgZXhwZWN0KHJlcy5kYXRhKS50b0VxdWFsKCdvaycpO1xuICAgICAgICBzY29wZUh0dHAuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgYWRkIGh0dHBzIHByb3RvY29sIGlmIG5vIHByb3RvY29sIGlzIHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLnJlcGxhY2UoJ2h0dHBzOi8vJywgJycpLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgfTtcblxuICAgICAgICBzY29wZS5nZXQoJy8nKS5yZXBseSgyMDAsICdvaycsIHsgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluJyB9KTtcblxuICAgICAgICBjb25zdCByZXF1ZXN0QWRhcHRlciA9IG5ldyBhZGFwdGVyKCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG4gICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0VxdWFsKDIwMCk7XG4gICAgICAgIGV4cGVjdChyZXMuZGF0YSkudG9FcXVhbCgnb2snKTtcbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0cmluZyBhcyBkYXRhIHBhcmFtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtc2cgPSAnU29tZSB0ZXN0IHN0cmVhbSBkYXRhJztcbiAgICAgICAgY29uc3QgbW9jayA9IGplc3RcbiAgICAgICAgICAuZm4oKVxuICAgICAgICAgIC5tb2NrTmFtZSgnYnVmZmVyRGF0YScpXG4gICAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZShtc2cpO1xuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuUE9TVCxcbiAgICAgICAgICBkYXRhOiBtc2csXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGUucG9zdCgnLycpLnJlcGx5KDIwMCwgZnVuY3Rpb24oXywgZGF0YSkge1xuICAgICAgICAgIHJldHVybiBtb2NrKGRhdGEpO1xuICAgICAgICB9LCB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbicgfSk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9FcXVhbCgyMDApO1xuICAgICAgICBleHBlY3QocmVzLmRhdGEpLnRvRXF1YWwobXNnKTtcblxuICAgICAgICBleHBlY3QobW9jaykudG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKG1zZyk7XG5cbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGd6aXAgc3VwcG9ydCBpcyBoYW5kbGVkIGJ5IHRoZSBicm93c2VyIG9uIHhociBzaWRlXG4gICAgICBpZiAoYWRhcHRlck5hbWUgIT09ICd4aHInKSB7XG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlZmxhdGUgcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCBkYXRhID0gemxpYi5nemlwU3luYyhCdWZmZXIuZnJvbSgnb2snLCAndXRmLTgnKSk7XG4gICAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoMjAwLCBkYXRhLCB7ICdDb250ZW50LWVuY29kaW5nJzogJ2d6aXAsIGRlZmxhdGUnLCAnQ29udGVudC10eXBlJzogJ3RleHQvcGxhaW4nIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgICAgICBleHBlY3QocmVzLmRhdGEpLnRvRXF1YWwoJ29rJyk7XG4gICAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSAyMDQgZ3ppcCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoMjA0LCAnJywgeyAnQ29udGVudC1lbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywgJ0NvbnRlbnQtdHlwZSc6ICd0ZXh0L3BsYWluJyB9KTtcblxuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0VxdWFsKDIwNCk7XG4gICAgICAgICAgZXhwZWN0KHJlcy5kYXRhKS50b0VxdWFsKG51bGwpO1xuXG4gICAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBCdWZmZXIgYXMgZGF0YSBwYXJhbScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBtc2cgPSAnU29tZSB0ZXN0IHN0cmVhbSBkYXRhJztcblxuICAgICAgICAgIGNvbnN0IG1vY2sgPSBqZXN0XG4gICAgICAgICAgICAuZm4oKVxuICAgICAgICAgICAgLm1vY2tOYW1lKCdidWZmZXJEYXRhJylcbiAgICAgICAgICAgIC5tb2NrUmV0dXJuVmFsdWUoJ29rJyk7XG5cbiAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5QT1NULFxuICAgICAgICAgICAgZGF0YTogQnVmZmVyLmZyb20obXNnLCAndXRmLTgnKSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgc2NvcGUucG9zdCgnLycpLnJlcGx5KDIwMCwgZnVuY3Rpb24oXywgZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIG1vY2soZGF0YSk7XG4gICAgICAgICAgfSwgeyAnQ29udGVudC10eXBlJzogJ3RleHQvcGxhaW4nIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgICAgICBleHBlY3QobW9jaykudG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKG1zZyk7XG5cbiAgICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBkYXRhIHR5cGUgaXMgdW5zdXBwb3J0ZWQnLCAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgUmVhZGFibGUgPSByZXF1aXJlKCdzdHJlYW0nKS5SZWFkYWJsZTtcblxuICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLlBPU1QsXG4gICAgICAgICAgICBkYXRhOiBSZWFkYWJsZS5mcm9tKFsndGVzdCddKSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuXG4gICAgICAgICAgcmV0dXJuIGV4cGVjdChyZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpKS5yZWplY3RzLnRvRXF1YWwoZXhwZWN0LmFueShGc1JlcXVlc3RFcnJvcikpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaXQoJ3Nob3VsZCBtYWtlIHJlcXVlc3Qgd2l0aCBhdXRoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBhdXRoID0ge1xuICAgICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0JyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgICBhdXRoLFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlLm9wdGlvbnMoJy8nKS5yZXBseSgyMDAsICdvaycpO1xuXG4gICAgICAgIHNjb3BlXG4gICAgICAgICAgLmdldCgnLycpXG4gICAgICAgICAgLmJhc2ljQXV0aCh7IHVzZXI6IGF1dGgudXNlcm5hbWUsIHBhc3M6IGF1dGgucGFzc3dvcmQgfSlcbiAgICAgICAgICAucmVwbHkoMjAwLCAnb2snLCB7ICdhY2Nlc3MtY29udHJvbC1hbGxvdy1vcmlnaW4nOiAnKicgfSk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0VxdWFsKDIwMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciBvbiBlbXB0eSB1c2VybmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYXV0aCA9IHtcbiAgICAgICAgICB1c2VybmFtZTogbnVsbCxcbiAgICAgICAgICBwYXNzd29yZDogJ3Rlc3QnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIGF1dGgsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICByZXR1cm4gZXhwZWN0KHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucykpLnJlamVjdHMudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciBvbiBlbXB0eSBwYXNzd29yZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYXV0aCA9IHtcbiAgICAgICAgICB1c2VybmFtZTogJ3Rlc3QnLFxuICAgICAgICAgIHBhc3N3b3JkOiBudWxsLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIGF1dGgsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICByZXR1cm4gZXhwZWN0KHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucykpLnJlamVjdHMudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBvdmVyd3JpdGUgYXV0aCBoZWFkZXIgaWYgYXV0aCBkYXRhIGlzIHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBhdXRoID0ge1xuICAgICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0JyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgICBhdXRoLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICd0ZXN0MTIzJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlLm9wdGlvbnMoJy8nKS5yZXBseSgyMDAsICdvaycpO1xuXG4gICAgICAgIHNjb3BlXG4gICAgICAgICAgLmdldCgnLycpXG4gICAgICAgICAgLmJhc2ljQXV0aCh7IHVzZXI6IGF1dGgudXNlcm5hbWUsIHBhc3M6IGF1dGgucGFzc3dvcmQgfSlcbiAgICAgICAgICAucmVwbHkoMjAwLCAnb2snKTtcblxuICAgICAgICBjb25zdCByZXF1ZXN0QWRhcHRlciA9IG5ldyBhZGFwdGVyKCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGNvbnRhaW4gZGVmYXVsdCBoZWFkZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrID0gamVzdFxuICAgICAgICAgIC5mbigpXG4gICAgICAgICAgLm1vY2tOYW1lKCdkZWZhdWx0L2hlYWRlcnMnKVxuICAgICAgICAgIC5tb2NrUmV0dXJuVmFsdWUoJ29rJyk7XG5cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoMjAwLCBmdW5jdGlvbihfLCBkYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIG1vY2sodGhpcy5yZXEuaGVhZGVycyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdEFkYXB0ZXIucmVxdWVzdChvcHRpb25zKTtcblxuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9FcXVhbCgyMDApO1xuICAgICAgICBleHBlY3QobW9jaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyAnZmlsZXN0YWNrLXNvdXJjZSc6IGV4cGVjdC5hbnkoU3RyaW5nKSwgJ2ZpbGVzdGFjay10cmFjZS1pZCc6IGV4cGVjdC5hbnkoU3RyaW5nKSwgJ2ZpbGVzdGFjay10cmFjZS1zcGFuJzogZXhwZWN0LmFueShTdHJpbmcpIH0pXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBvbWl0IGRlZmF1bHQgaGVhZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9jayA9IGplc3RcbiAgICAgICAgICAuZm4oKVxuICAgICAgICAgIC5tb2NrTmFtZSgnZGVmYXVsdC9oZWFkZXJzJylcbiAgICAgICAgICAubW9ja1JldHVyblZhbHVlKCdvaycpO1xuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIGZpbGVzdGFja0hlYWRlcnM6IGZhbHNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlLmdldCgnLycpLnJlcGx5KDIwMCwgZnVuY3Rpb24oXywgZGF0YSkge1xuICAgICAgICAgIHJldHVybiBtb2NrKHRoaXMucmVxLmhlYWRlcnMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXF1ZXN0QWRhcHRlciA9IG5ldyBhZGFwdGVyKCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgICAgZXhwZWN0KG1vY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIGV4cGVjdC5ub3Qub2JqZWN0Q29udGFpbmluZyh7ICdmaWxlc3RhY2stc291cmNlJzogZXhwZWN0LmFueShTdHJpbmcpLCAnZmlsZXN0YWNrLXRyYWNlLWlkJzogZXhwZWN0LmFueShTdHJpbmcpLCAnZmlsZXN0YWNrLXRyYWNlLXNwYW4nOiBleHBlY3QuYW55KFN0cmluZykgfSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNraXAgdW5kZWZpbmVkIGhlYWRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2sgPSBqZXN0XG4gICAgICAgICAgLmZuKClcbiAgICAgICAgICAubW9ja05hbWUoJ3VuZGVmaW5lZC9oZWFkZXJzJylcbiAgICAgICAgICAubW9ja1JldHVyblZhbHVlKCdvaycpO1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICB0ZXN0OiB1bmRlZmluZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICBzY29wZS5nZXQoJy8nKS5yZXBseSgyMDAsIGZ1bmN0aW9uKF8sIGRhdGEpIHtcbiAgICAgICAgICByZXR1cm4gbW9jayh0aGlzLnJlcS5oZWFkZXJzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9FcXVhbCgyMDApO1xuICAgICAgICBleHBlY3QobW9jaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm5vdC5vYmplY3RDb250YWluaW5nKHsgdGVzdDogdW5kZWZpbmVkIH0pKTtcblxuICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdyZWRpcmVjdHMgJywgKCkgPT4ge1xuICAgICAgLy8geGhyIHJlZGlyZWN0cyBhcmUgaGFuZGxlZCBieSB0aGUgYnJvd3NlclxuICAgICAgaWYgKGFkYXB0ZXJOYW1lICE9PSAneGhyJykge1xuICAgICAgICBpdCgnc2hvdWxkIGZvbGxvdyAzMDIgcmVkaXJlY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgdGVzdDogMTIzIH07XG5cbiAgICAgICAgICBzY29wZS5nZXQoJy8nKS5yZXBseSgzMDIsICdvaycsIHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBgJHt1cmx9L3Jlc3BgLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNjb3BlLmdldCgnL3Jlc3AnKS5yZXBseSgyMDAsIHJlc3BvbnNlLCB7XG4gICAgICAgICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvRXF1YWwoMjAwKTtcbiAgICAgICAgICBleHBlY3QocmVzLmRhdGEpLnRvRXF1YWwocmVzcG9uc2UpO1xuXG4gICAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gbm8gbG9jYXRpb24gaXMgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBzY29wZS5nZXQoJy8nKS5yZXBseSgzMDIsICdvaycsIHsgbG9jYXRpb246ICcnIH0pO1xuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICAgIGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBlcnJvciBpbiB0cnkgd2lsbCBub3QgZW1pdCBlcnJvclxuICAgICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVycikudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLlJFRElSRUNUKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIChSRURJUkVDVCkgb24gbWF4IHJlZGlyZWN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGlmIChhZGFwdGVyTmFtZSA9PT0gJ3hocicpIHtcbiAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMoJy8nKS5yZXBseSgyMDAsICdvaycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNjb3BlXG4gICAgICAgICAgICAuZ2V0KCcvJylcbiAgICAgICAgICAgIC5yZXBseSgzMDIsICdvaycsIHtcbiAgICAgICAgICAgICAgbG9jYXRpb246IGAke3VybH0vYWAsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmdldCgnL2EnKVxuICAgICAgICAgICAgLnJlcGx5KDMwMSwgJ29rJywge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogYCR7dXJsfS9iYCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZ2V0KCcvYicpXG4gICAgICAgICAgICAucmVwbHkoMzAyLCAnb2snLCB7XG4gICAgICAgICAgICAgIGxvY2F0aW9uOiBgJHt1cmx9L2NgLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5nZXQoJy9jJylcbiAgICAgICAgICAgIC5yZXBseSgzMDEsICdvaycsIHtcbiAgICAgICAgICAgICAgbG9jYXRpb246IGAke3VybH0vZGAsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmdldCgnL2QnKVxuICAgICAgICAgICAgLnJlcGx5KDMwMiwgJ29rJywge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogYCR7dXJsfS9lYCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZ2V0KCcvZScpXG4gICAgICAgICAgICAucmVwbHkoMzAxLCAnb2snLCB7XG4gICAgICAgICAgICAgIGxvY2F0aW9uOiBgJHt1cmx9L2ZgLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5nZXQoJy9mJylcbiAgICAgICAgICAgIC5yZXBseSgzMDIsICdvaycsIHtcbiAgICAgICAgICAgICAgbG9jYXRpb246IGAke3VybH0vZ2AsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmdldCgnL2cnKVxuICAgICAgICAgICAgLnJlcGx5KDMwMSwgJ29rJywge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogYCR7dXJsfS9oYCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZ2V0KCcvaCcpXG4gICAgICAgICAgICAucmVwbHkoMzAyLCAnb2snLCB7XG4gICAgICAgICAgICAgIGxvY2F0aW9uOiBgJHt1cmx9L2lgLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5nZXQoJy9pJylcbiAgICAgICAgICAgIC5yZXBseSgzMDEsICdvaycsIHtcbiAgICAgICAgICAgICAgbG9jYXRpb246IGAke3VybH0vamAsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmdldCgnL2onKVxuICAgICAgICAgICAgLnJlcGx5KDMwMiwgJ29rJywge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogYCR7dXJsfS9rYCxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICAgIGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBlcnJvciBpbiB0cnkgd2lsbCBub3QgZW1pdCBlcnJvclxuICAgICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVycikudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLlJFRElSRUNUKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igb24gcmVkaXJlY3QgbG9vcCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHNjb3BlXG4gICAgICAgICAgICAuZ2V0KCcvJylcbiAgICAgICAgICAgIC5yZXBseSgzMDIsICdvaycsIHsgbG9jYXRpb246IGAke3VybH0vYWAgfSlcbiAgICAgICAgICAgIC5nZXQoJy9hJylcbiAgICAgICAgICAgIC5yZXBseSgzMDIsICdvaycsIHsgbG9jYXRpb246IGAke3VybH0vYWAgfSlcbiAgICAgICAgICAgIC5nZXQoJy9hJylcbiAgICAgICAgICAgIC5yZXBseSgyMDAsICdvaycpO1xuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICAgIGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBlcnJvciBpbiB0cnkgd2lsbCBub3QgZW1pdCBlcnJvclxuICAgICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVycikudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLlJFRElSRUNUKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKGFkYXB0ZXJOYW1lID09PSAneGhyJykge1xuICAgICAgZGVzY3JpYmUoJ3JlcXVlc3QgZm9ybScsICgpID0+IHtcbiAgICAgICAgaXQoJ1Nob3VsZCBzZW5kIGZvcm0gZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG5cbiAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5QT1NULFxuICAgICAgICAgICAgZGF0YTogZm9ybSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3QgcmVzcCA9IHsgZm9ybTogJ29rJyB9O1xuXG4gICAgICAgICAgc2NvcGUucG9zdCgnLycpLnJlcGx5KDIwMCwgcmVzcCwgeyAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9FcXVhbCgyMDApO1xuICAgICAgICAgIGV4cGVjdChyZXMuZGF0YSkudG9FcXVhbChyZXNwKTtcblxuICAgICAgICAgIHNjb3BlLmRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBkZXNjcmliZSgnNHh4IGFuZCA1eHggZXJyb3JzIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgNHh4IHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBlcnJvclJlc3AgPSB7IHRlc3Q6IDEyMyB9O1xuXG4gICAgICAgIHNjb3BlLmdldCgnLycpLnJlcGx5KDQwNCwgZXJyb3JSZXNwLCB7XG4gICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0QWRhcHRlciA9IG5ldyBhZGFwdGVyKCk7XG4gICAgICAgICAgYXdhaXQgcmVxdWVzdEFkYXB0ZXIucmVxdWVzdChvcHRpb25zKTtcbiAgICAgICAgICBleHBlY3QoZmFsc2UpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoZXhwZWN0LmFueShGc1JlcXVlc3RFcnJvcikpO1xuICAgICAgICAgIGV4cGVjdChlcnIuY29kZSkudG9FcXVhbChGc1JlcXVlc3RFcnJvckNvZGUuUkVRVUVTVCk7XG4gICAgICAgICAgZXhwZWN0KGVyci5yZXNwb25zZS5zdGF0dXMpLnRvRXF1YWwoNDA0KTtcbiAgICAgICAgICBleHBlY3QoZXJyLnJlc3BvbnNlLmRhdGEpLnRvRXF1YWwoZXJyb3JSZXNwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNjb3BlLmRvbmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSA1eHggcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGVycm9yUmVzcCA9IHsgdGVzdDogMTIzIH07XG5cbiAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoNTAxLCBlcnJvclJlc3AsIHtcbiAgICAgICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9KTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgICAgIGV4cGVjdChmYWxzZSkudG9FcXVhbCh0cnVlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgZXhwZWN0KGVycikudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICAgICAgZXhwZWN0KGVyci5jb2RlKS50b0VxdWFsKEZzUmVxdWVzdEVycm9yQ29kZS5TRVJWRVIpO1xuICAgICAgICAgIGV4cGVjdChlcnIucmVzcG9uc2Uuc3RhdHVzKS50b0VxdWFsKDUwMSk7XG4gICAgICAgICAgZXhwZWN0KGVyci5yZXNwb25zZS5kYXRhKS50b0VxdWFsKGVycm9yUmVzcCk7XG4gICAgICAgIH1cblxuICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChhZGFwdGVyTmFtZSA9PT0gJ3hocicpIHtcbiAgICAgIGRlc2NyaWJlKCdwcm9ncmVzcyBldmVudCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdXBsb2FkIHByb2dyZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHByb2dyZXNzU3B5ID0gamVzdFxuICAgICAgICAgICAgLmZuKClcbiAgICAgICAgICAgIC5tb2NrTmFtZSgnYnVmZmVyRGF0YScpXG4gICAgICAgICAgICAubW9ja1JldHVyblRoaXMoKTtcbiAgICAgICAgICBjb25zdCBidWYgPSBCdWZmZXIuYWxsb2MoMTAyNCk7XG4gICAgICAgICAgYnVmLmZpbGwoJ2EnKTtcblxuICAgICAgICAgIGNvbnN0IG9wdGlvbnM6IEZzUmVxdWVzdE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB1cmw6IGAke3VybH0vcHJvZ3Jlc3NgLFxuICAgICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuUE9TVCxcbiAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IHByb2dyZXNzU3B5LFxuICAgICAgICAgICAgZGF0YTogYnVmLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBzY29wZS5vcHRpb25zKCcvcHJvZ3Jlc3MnKS5yZXBseSgyMDAsICdvaycsIHtcbiAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBzY29wZS5wb3N0KCcvcHJvZ3Jlc3MnKS5yZXBseSgyMDAsICdvaycsIHtcbiAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCByZXF1ZXN0QWRhcHRlciA9IG5ldyBhZGFwdGVyKCk7XG4gICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdEFkYXB0ZXIucmVxdWVzdChvcHRpb25zKTtcbiAgICAgICAgICAvLyBmb3IganNkb20gd2UgY2Fubm90IGNoZWNrIHByb2dyZXNzIGV2ZW50IGNvcnJlY3RseVxuICAgICAgICAgIGV4cGVjdChwcm9ncmVzc1NweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlc2NyaWJlKCdjYW5jZWxUb2tlbicsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgdGhyb3cgYWJvcnQgcmVxdWVzdCB3aGVuIHRva2VuIHdpbGwgYmUgY2FsbGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0b2tlbiA9IG5ldyBGc0NhbmNlbFRva2VuKCk7XG5cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgICAgY2FuY2VsVG9rZW46IHRva2VuLFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlXG4gICAgICAgICAgLmdldCgnLycpXG4gICAgICAgICAgLmRlbGF5KDIwMDApXG4gICAgICAgICAgLnJlcGx5KDIwMCwgJ29rJywge1xuICAgICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0b2tlbi5jYW5jZWwoKTtcbiAgICAgICAgfSwgMTAwKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgICAgLy8gcmV0dXJuIGVycm9yIGluIHRyeSB3aWxsIG5vdCBlbWl0IGVycm9yXG4gICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBleHBlY3QoZXJyKS50b0VxdWFsKGV4cGVjdC5hbnkoRnNSZXF1ZXN0RXJyb3IpKTtcbiAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLkFCT1JURUQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBub3QgdGhyb3cgdW5kZWZpbmVkIGVycm9yIHdoZW4gY2FuY2VsIHRva2VuIHdpbGwgYmUgY2FsbGVkIGFmdGVyIHJlcXVlc3QgZmluaXNoZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gbmV3IEZzQ2FuY2VsVG9rZW4oKTtcblxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgICBjYW5jZWxUb2tlbjogdG9rZW4sXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHkoMjAwLCAnb2snLCB7XG4gICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICd0ZXh0L3BsYWluJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgICB0b2tlbi5jYW5jZWwoKTtcblxuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9FcXVhbCgyMDApO1xuICAgICAgICBleHBlY3QocmVzLmRhdGEpLnRvRXF1YWwoJ29rJyk7XG5cbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnTmV0d29yayBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIG9uIGRvbWFpbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9zb21lLWJhZGQtdXJsLmVyJyxcbiAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICByZXR1cm4gZXhwZWN0KHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucykpLnJlamVjdHMudG9FcXVhbChleHBlY3QuYW55KEZzUmVxdWVzdEVycm9yKSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCB0aHJvdyBhbiBGaWxlc3RhY2tFcnJvciBvbiBzb2NrZXQgYWJvcnQgd2l0aCBGc1JlcXVlc3RFcnJvckNvZGUuVElNRU9VVEVEIGNvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIHRpbWVvdXQ6IDUwLFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlXG4gICAgICAgICAgLmdldCgnLycpXG4gICAgICAgICAgLmRlbGF5KDIwMDApXG4gICAgICAgICAgLnJlcGx5KDIwMCwgJ29rJywge1xuICAgICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgICAgLy8gcmV0dXJuIGVycm9yIGluIHRyeSB3aWxsIG5vdCBlbWl0IGVycm9yXG4gICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBleHBlY3QoZXJyKS50b0VxdWFsKGV4cGVjdC5hbnkoRnNSZXF1ZXN0RXJyb3IpKTtcbiAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLlRJTUVPVVQpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgdGhyb3cgYW4gRmlsZXN0YWNrRXJyb3Igb24gcmVzcG9uc2UgRUNPTk5SRUZVU0VEIGVycm9yIHdpdGggRnNSZXF1ZXN0RXJyb3JDb2RlLk5FVFdPUksgY29kZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICBtZXRob2Q6IEZzSHR0cE1ldGhvZC5HRVQsXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGUuZ2V0KCcvJykucmVwbHlXaXRoRXJyb3IoeyBjb2RlOiAnRUNPTk5SRUZVU0VEJyB9KTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgICAgLy8gcmV0dXJuIGVycm9yIGluIHRyeSB3aWxsIG5vdCBlbWl0IGVycm9yXG4gICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBleHBlY3QoZXJyKS50b0VxdWFsKGV4cGVjdC5hbnkoRnNSZXF1ZXN0RXJyb3IpKTtcbiAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLk5FVFdPUkspO1xuICAgICAgICB9XG5cbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgdGhyb3cgYW4gRmlsZXN0YWNrRXJyb3Igb24gcmVzcG9uc2UgRUNPTk5SRVNFVCBlcnJvciB3aXRoIEZzUmVxdWVzdEVycm9yQ29kZS5ORVRXT1JLIGNvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlLmdldCgnLycpLnJlcGx5V2l0aEVycm9yKHsgY29kZTogJ0VDT05OUkVTRVQnIH0pO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICAvLyByZXR1cm4gZXJyb3IgaW4gdHJ5IHdpbGwgbm90IGVtaXQgZXJyb3JcbiAgICAgICAgICBleHBlY3QoZmFsc2UpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoZXhwZWN0LmFueShGc1JlcXVlc3RFcnJvcikpO1xuICAgICAgICAgIGV4cGVjdChlcnIuY29kZSkudG9FcXVhbChGc1JlcXVlc3RFcnJvckNvZGUuTkVUV09SSyk7XG4gICAgICAgIH1cblxuICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCB0aHJvdyBhbiBGaWxlc3RhY2tFcnJvciBvbiByZXNwb25zZSBFTk9URk9VTkQgZXJyb3Igd2l0aCBGc1JlcXVlc3RFcnJvckNvZGUuTkVUV09SSyBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogRnNIdHRwTWV0aG9kLkdFVCxcbiAgICAgICAgfTtcblxuICAgICAgICBzY29wZS5nZXQoJy8nKS5yZXBseVdpdGhFcnJvcih7IGNvZGU6ICdFTk9URk9VTkQnIH0pO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVxdWVzdEFkYXB0ZXIgPSBuZXcgYWRhcHRlcigpO1xuICAgICAgICAgIGF3YWl0IHJlcXVlc3RBZGFwdGVyLnJlcXVlc3Qob3B0aW9ucyk7XG5cbiAgICAgICAgICAvLyByZXR1cm4gZXJyb3IgaW4gdHJ5IHdpbGwgbm90IGVtaXQgZXJyb3JcbiAgICAgICAgICBleHBlY3QoZmFsc2UpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoZXhwZWN0LmFueShGc1JlcXVlc3RFcnJvcikpO1xuICAgICAgICAgIGV4cGVjdChlcnIuY29kZSkudG9FcXVhbChGc1JlcXVlc3RFcnJvckNvZGUuTkVUV09SSyk7XG4gICAgICAgIH1cblxuICAgICAgICBzY29wZS5kb25lKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBhYm9ydCByZXF1ZXN0IG9uIHRpbWVvdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWV0aG9kOiBGc0h0dHBNZXRob2QuR0VULFxuICAgICAgICAgIHRpbWVvdXQ6IDEwMDAsXG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGVcbiAgICAgICAgICAuZ2V0KCcvJylcbiAgICAgICAgICAuZGVsYXkoMjAwMClcbiAgICAgICAgICAucmVwbHkoMjAwLCAnb2snKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3RBZGFwdGVyID0gbmV3IGFkYXB0ZXIoKTtcbiAgICAgICAgICBhd2FpdCByZXF1ZXN0QWRhcHRlci5yZXF1ZXN0KG9wdGlvbnMpO1xuXG4gICAgICAgICAgLy8gcmV0dXJuIGVycm9yIGluIHRyeSB3aWxsIG5vdCBlbWl0IGVycm9yXG4gICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0VxdWFsKHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBleHBlY3QoZXJyKS50b0VxdWFsKGV4cGVjdC5hbnkoRnNSZXF1ZXN0RXJyb3IpKTtcbiAgICAgICAgICBleHBlY3QoZXJyLmNvZGUpLnRvRXF1YWwoRnNSZXF1ZXN0RXJyb3JDb2RlLlRJTUVPVVQpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2NvcGUuZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcbiJdfQ==
